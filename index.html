<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark" data-elder="0" data-contrast="0">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Agenda CCB ‚Äî Amambai</title>
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="color-scheme" content="dark light" />

  <style>
    :root{
      --bg:#ffffff; --card:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e2e8f0;
      --accent:#0f172a; --accent2:#0ea5e9; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
      --shadow: 0 10px 22px rgba(2,6,23,.06);
      --shadow2: 0 22px 54px rgba(2,6,23,.10);
      --r:18px;
      --fs: 14px;             /* base font size */
      --tap: 44px;            /* min touch target */
      --pad: 12px;            /* base spacing */
    }

    /* Dark */
    [data-theme="dark"]{
      --bg:#0b1220; --card:#0b152a; --ink:#e5e7eb; --muted:#94a3b8; --line:#1f2a44;
      --accent:#e5e7eb; --accent2:#38bdf8; --ok:#22c55e;
      --shadow: 0 14px 28px rgba(0,0,0,.28);
      --shadow2: 0 22px 54px rgba(0,0,0,.34);
    }

    /* Elder mode: bigger text + spacing */
    [data-elder="1"]{
      --fs: 17px;
      --tap: 52px;
      --pad: 16px;
      --r: 20px;
    }

    /* High contrast mode: stronger borders + less transparency */
    [data-contrast="1"]{
      --line:#60a5fa;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: var(--fs);
      background:
        radial-gradient(1200px 700px at 15% -10%, rgba(56,189,248,0.14), rgba(0,0,0,0) 55%),
        radial-gradient(900px 600px at 110% 0%, rgba(148,163,184,0.10), rgba(0,0,0,0) 50%),
        radial-gradient(900px 650px at 50% 120%, rgba(56,189,248,0.08), rgba(0,0,0,0) 55%),
        linear-gradient(135deg, #0b1220 0%, #0f172a 55%, #0b1220 100%);
      background-attachment: fixed;
      color: var(--ink);
      padding-bottom: 92px; /* espa√ßo pra barra inferior */
    }

    .wrap{max-width:1040px;margin:0 auto;padding:16px 14px 18px}
    .header{
      border:1px solid rgba(56,189,248,0.22);
      border-radius: calc(var(--r) + 10px);
      background: linear-gradient(180deg, rgba(15,23,42,0.92), rgba(11,18,32,0.86));
      box-shadow: 0 18px 46px rgba(0,0,0,0.34);
      padding: var(--pad);
    }
    [data-theme="light"] body{
      background:
        radial-gradient(1200px 700px at 15% -10%, rgba(14,165,233,0.16), rgba(0,0,0,0) 55%),
        radial-gradient(900px 600px at 110% 0%, rgba(15,23,42,0.06), rgba(0,0,0,0) 50%),
        linear-gradient(135deg, #f8fafc 0%, #ffffff 60%, #f1f5f9 100%);
    }
    [data-theme="light"] .header{
      background: linear-gradient(180deg, rgba(248,250,252,.96), rgba(255,255,255,.88));
      box-shadow: var(--shadow2);
      border:1px solid var(--line);
    }

    /* Topo */
    .topo{
      width: 100%;
      max-width: 1040px;
      margin: 0 auto 12px auto;
      padding: var(--pad);
      border-radius: var(--r);
      border: 1px solid rgba(148,163,184,0.22);
      background: rgba(15,23,42,0.55);
      backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      gap:12px;
    }
    [data-theme="light"] .topo{
      background: rgba(255,255,255,0.78);
      border:1px solid var(--line);
    }
    [data-contrast="1"] .topo{ background: var(--card); }
    [data-contrast="1"][data-theme="dark"] .topo{ background: #0b152a; }

    .logoMark{
      width: 74px; height: 48px;
      border-radius: 12px;
      border: 1px solid rgba(56,189,248,0.25);
      background: #fff;
      display:grid;
      place-items:center;
      overflow:hidden;
      box-shadow: 0 10px 22px rgba(0,0,0,0.12);
      flex: 0 0 auto;
    }
    .logoMark svg{width:64px;height:36px}
    .titulo h1{margin:0;font-size:1.15rem;font-weight:950;color:var(--accent);letter-spacing:.2px}
    .subtitulo{margin:6px 0 0;font-size:.92rem;color:var(--muted);line-height:1.35}

    .toprow{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .titles p{margin:0;font-size:.92rem;line-height:1.35;color:var(--muted)}
    .actions{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    .btn{
      appearance:none;border:1px solid var(--line);
      min-height: var(--tap);
      background: rgba(255,255,255,.78);
      color: var(--accent);
      font-weight:950;font-size:.9rem;padding:10px 12px;border-radius:14px;cursor:pointer;
    }
    [data-theme="dark"] .btn{background: rgba(11,18,32,.70);}
    [data-contrast="1"] .btn{background: var(--card);}
    .btn.primary{border-color: rgba(56,189,248,.50);}
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      min-height: var(--tap);
      font-size:.92rem;color:var(--muted);
      display:flex;gap:8px;align-items:center;
      background:rgba(255,255,255,.62)
    }
    [data-theme="dark"] .pill{background:rgba(11,18,32,.62)}
    [data-contrast="1"] .pill{background: var(--card);}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--accent2);box-shadow:0 0 0 5px rgba(56,189,248,.14);}

    .banner{
      margin-top:12px;border:1px solid rgba(56,189,248,.40);
      border-radius: var(--r);background: rgba(56,189,248,.10);
      padding:12px 14px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    }
    [data-contrast="1"] .banner{ background: var(--card); }
    .banner .big{font-weight:950;font-size:1rem}
    .banner .small{font-size:.92rem;color:var(--muted);line-height:1.35}
    .banner .right{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pchip{
      font-size:.92rem;font-weight:950;padding:10px 12px;border-radius:999px;
      border:1px solid rgba(56,189,248,.24);
      background: rgba(56,189,248,.12);color: var(--accent);white-space:nowrap;
      text-decoration:none;
      min-height: var(--tap);
      display:inline-flex;align-items:center;
    }
    [data-contrast="1"] .pchip{ background: var(--card); border-color: var(--line); }
    .pchip.ok{border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.14);}
    .pchip.dim{border-color: rgba(148,163,184,.22); background: rgba(148,163,184,.12); opacity:.95;}

    .nav{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .nav a{
      border:1px solid var(--line);
      background: rgba(255,255,255,.72);
      padding:12px 14px;border-radius:14px;
      min-height: var(--tap);
      font-weight:950;font-size:1rem;color:var(--accent);text-decoration:none;
      display:inline-flex;align-items:center;
    }
    [data-theme="dark"] .nav a{background: rgba(11,18,32,.70);}
    [data-contrast="1"] .nav a{background: var(--card);}
    .nav a[aria-current="true"]{border-color: rgba(56,189,248,.60);}

    .controls{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .search{
      flex:1 1 280px;
      display:flex;gap:10px;align-items:center;
      border:1px solid var(--line);border-radius:16px;
      padding:12px 14px;background: rgba(255,255,255,.72);
      min-height: var(--tap);
    }
    [data-theme="dark"] .search{background: rgba(11,18,32,.70);}
    [data-contrast="1"] .search{background: var(--card);}
    .search input{border:0;outline:none;background:transparent;color:var(--ink);font-size:1rem;width:100%}
    .helper{font-size:.92rem;color:var(--muted)}

    .quick{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px
    }
    .qbtn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.72);
      padding:12px 14px;border-radius:16px;
      min-height: var(--tap);
      font-weight:950;font-size:1rem;color:var(--accent);
      text-decoration:none;
      cursor:pointer;
      display:inline-flex;align-items:center;gap:10px;
    }
    [data-theme="dark"] .qbtn{background: rgba(11,18,32,.70);}
    [data-contrast="1"] .qbtn{background: var(--card);}
    .qbtn.primary{border-color: rgba(56,189,248,.60);}
    .qbtn.ok{border-color: rgba(34,197,94,.40);}
    .qbtn.warn{border-color: rgba(245,158,11,.40);}

    .section{margin-top:18px}
    .section h3{margin:0 0 10px;font-size:1.05rem;font-weight:950;color:var(--accent)}

    .daycard{
      border:1px solid rgba(148,163,184,0.22);
      border-radius: var(--r);
      background: rgba(15,23,42,0.42);
      box-shadow: var(--shadow);
      overflow:hidden;margin:12px 0;
    }
    [data-theme="light"] .daycard{background: var(--card); border:1px solid var(--line)}
    [data-contrast="1"] .daycard{background: var(--card); border:1px solid var(--line)}
    .daycard.today{
      border-color: rgba(56,189,248,.78);
      box-shadow: 0 18px 46px rgba(56,189,248,.14);
    }
    .dayhead{
      padding:14px 14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      border-bottom:1px solid var(--line);
    }
    .dayname{font-weight:950;font-size:1.05rem;color:var(--accent);}
    .badge{
      font-size:.92rem;color:var(--muted);border:1px solid var(--line);padding:10px 12px;border-radius:999px;
      min-height: var(--tap);
      display:inline-flex;align-items:center;
      background:rgba(255,255,255,.62);
    }
    [data-theme="dark"] .badge{background:rgba(11,18,32,.62);}
    [data-contrast="1"] .badge{background: var(--card);}
    .badge.today{border-color: rgba(56,189,248,.55); color: var(--accent); background: rgba(56,189,248,.14);}

    .items{padding:12px 14px 14px;display:flex;flex-direction:column;gap:12px}
    .item{
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 16px;
      background: rgba(2,6,23,0.18);
      padding:12px 12px;
    }
    [data-theme="light"] .item{background: rgba(248,250,252,.65); border:1px solid var(--line)}
    [data-contrast="1"] .item{background: var(--card); border:1px solid var(--line)}
    .item.next{border-color: rgba(56,189,248,.78); box-shadow: 0 14px 28px rgba(56,189,248,.12);}
    .item.now{border-color: rgba(34,197,94,.70); box-shadow: 0 14px 28px rgba(34,197,94,.14);}
    .item.past{opacity:.72}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start;justify-content:space-between}
    .title{font-weight:950;font-size:1.05rem;line-height:1.25}
    .place{margin-top:6px;color:var(--muted);font-size:.95rem;line-height:1.35}
    .meta{margin-top:10px;font-size:.95rem}
    .link{color:var(--accent2);font-weight:950;text-decoration:none}
    .link:hover{text-decoration:underline}
    .time{
      font-weight:950;font-size:1rem;color: var(--accent);
      padding:10px 12px;border-radius:999px;border:1px solid rgba(56,189,248,.24);
      background: rgba(56,189,248,.12);white-space:nowrap;
      min-height: var(--tap);
      display:inline-flex;align-items:center;
    }
    [data-contrast="1"] .time{background: var(--card); border-color: var(--line);}
    .tag{
      display:inline-block;font-size:.9rem;padding:6px 10px;border-radius:999px;border:1px solid var(--line);
      background: rgba(255,255,255,.64);color: var(--muted);margin-left:6px;
    }
    [data-theme="dark"] .tag{background: rgba(11,18,32,.62);}
    [data-contrast="1"] .tag{background: var(--card);}

    .tablecard{border:1px solid var(--line);border-radius: var(--r);background: var(--card);box-shadow: var(--shadow);overflow:hidden;}
    [data-theme="dark"] .tablecard{background: rgba(15,23,42,0.42); border:1px solid rgba(148,163,184,0.22)}
    [data-contrast="1"] .tablecard{background: var(--card); border:1px solid var(--line)}
    .tablehead{padding:14px;border-bottom:1px solid var(--line);}
    .tablehead .t{font-weight:950;font-size:1.05rem;color:var(--accent);}
    .tablehead .s{margin-top:8px;font-size:.95rem;color:var(--muted);line-height:1.35}
    .tablewrap{overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:.95rem}
    th,td{padding:12px 12px;border-bottom:1px solid var(--line);vertical-align:top}
    th{text-align:left;color:var(--muted);background:rgba(15,23,42,.75);}
    [data-theme="light"] th{background:rgba(248,250,252,.85);}
    [data-contrast="1"] th{background: var(--card);}
    tr:last-child td{border-bottom:0}
    .emph{font-weight:950}

    .toast{
      position:fixed;left:50%;bottom:92px;transform:translateX(-50%);
      background: rgba(2,6,23,.92);color:#fff;
      padding:12px 14px;border-radius:14px;display:none;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
      font-size:.95rem;max-width:92vw;text-align:center;z-index:60;
    }
    [data-theme="dark"] .toast{background: rgba(229,231,235,.92); color:#0b1220;}

    /* Barra inferior estilo ‚Äúapp‚Äù */
    .bnav{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 10px calc(10px + env(safe-area-inset-bottom, 0px));
      background: rgba(2,6,23,.78);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(148,163,184,.22);
      z-index:70;
    }
    [data-theme="light"] .bnav{
      background: rgba(255,255,255,.90);
      border-top: 1px solid var(--line);
    }
    [data-contrast="1"] .bnav{ background: var(--card); }
    .bnav .grid{
      max-width: 1040px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
    }
    .bnav button{
      border:1px solid rgba(148,163,184,.22);
      background: rgba(11,18,32,.72);
      color: var(--ink);
      border-radius: 16px;
      min-height: 56px;
      font-weight: 950;
      font-size: .95rem;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:4px;
      padding:8px 10px;
    }
    [data-theme="light"] .bnav button{
      background: rgba(248,250,252,.95);
      color: var(--accent);
      border-color: var(--line);
    }
    [data-contrast="1"] .bnav button{ background: var(--card); border-color: var(--line); }
    .bnav button.primary{border-color: rgba(56,189,248,.55);}
    .bnav .sub{font-weight:700; font-size:.78rem; color: var(--muted); line-height:1}
    .bnav .icon{font-size:1.1rem; line-height:1}

    /* Modal simples */
    .modalBack{
      position:fixed;inset:0;
      background: rgba(0,0,0,.45);
      display:none;align-items:flex-end;justify-content:center;
      z-index:80;
      padding: 12px;
    }
    .modal{
      width:min(740px, 100%);
      background: var(--card);
      border:1px solid var(--line);
      border-radius: 20px;
      box-shadow: var(--shadow2);
      padding: 14px;
    }
    [data-theme="dark"] .modal{ background: #0b152a; border-color: rgba(148,163,184,0.22); }
    .modal h4{margin:0 0 8px;font-size:1.05rem;font-weight:950}
    .modal p{margin:0 0 12px;color:var(--muted);line-height:1.4}
    .modal .row{
      display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;align-items:center
    }
    .modal .mBtn{
      min-height: var(--tap);
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(56,189,248,.12);
      color: var(--accent);
      font-weight:950;
      padding: 10px 12px;
      cursor:pointer;
    }
    [data-theme="dark"] .modal .mBtn{ background: rgba(2,6,23,.25); }

    @media (max-width: 520px){
      .actions{width:100%;justify-content:space-between}
      .bnav .grid{grid-template-columns: repeat(5, 1fr);}
      .bnav button{min-height: 60px;}
    }

    @media print{
      body{background:#fff !important;color:#000 !important; padding-bottom:0 !important}
      .actions,.nav,.controls,.banner,.bnav,.toast,.modalBack{display:none !important}
      .wrap{max-width:100%;padding:0}
      .header{box-shadow:none;border:0;border-radius:0;background:#fff !important}
      .topo{box-shadow:none;border:0;border-radius:0;background:#fff !important}
      .daycard,.tablecard{box-shadow:none}
      .daycard{page-break-inside:avoid}
      .item{background:#fff !important}
      .tag{border:1px solid #ddd}
      a{color:#000 !important;text-decoration:none}
    }
  </style>
</head>

<body>
  <div class="wrap">

    <header class="topo" role="banner">
      <div class="logoMark" aria-label="Logo CCB">
        <svg viewBox="0 0 240 140" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="CCB">
          <rect x="0" y="0" width="240" height="140" rx="18" fill="#ffffff"/>
          <path d="M120 18c27 0 50 17 58 40-9-6-20-10-33-10-18 0-34 8-44 20-10-12-26-20-44-20-13 0-24 4-33 10 8-23 31-40 58-40z" fill="#0f172a" opacity="0.92"/>
          <path d="M47 78c10-10 24-16 40-16 14 0 26 5 35 13 9-8 21-13 35-13 16 0 30 6 40 16-14 26-39 44-75 44S61 104 47 78z" fill="#0ea5e9" opacity="0.92"/>
          <text x="120" y="96" text-anchor="middle" font-family="Arial, Helvetica, sans-serif" font-size="34" font-weight="900" fill="#0f172a">CCB</text>
        </svg>
      </div>
      <div class="titulo">
        <h1>Agenda CCB ‚Äî Amambai</h1>
        <p class="subtitulo">Toque nos bot√µes abaixo (modo app). Ideal para idosos: letras maiores e alto contraste.</p>
      </div>
    </header>

    <div class="header">
      <div class="toprow">
        <div class="titles">
          <p><strong>Amambai ‚Äî MS</strong> ‚Ä¢ Se abrir pelo WhatsApp, toque ‚ÄúAbrir no navegador‚Äù.</p>
        </div>

        <div class="actions">
          <div class="pill"><span class="dot"></span><span id="modeTxt">Modo escuro</span></div>
          <button class="btn" type="button" onclick="printPage()">Imprimir</button>
          <button class="btn" type="button" onclick="toggleTheme()">Claro/Escuro</button>
          <button class="btn primary" type="button" onclick="shareOrCopy()">Compartilhar</button>
        </div>
      </div>

      <div class="banner" id="banner">
        <div>
          <div class="big" id="bannerBig">HOJE</div>
          <div class="small" id="bannerSmall">Carregando‚Ä¶</div>
        </div>
        <div class="right">
          <span class="pchip dim" id="clockChip">--:--</span>
          <span class="pchip dim" id="weekChip">Semana: ‚Äî</span>
          <span class="pchip ok" id="countChip">Falta: ‚Äî</span>
          <a class="pchip" id="mapsChip" href="#" target="_blank" rel="noopener">Abrir no Maps</a>
        </div>
      </div>

      <nav class="nav" aria-label="Se√ß√µes">
        <a href="#cultos" aria-current="true">Cultos e Reuni√µes</a>
        <a href="#festas">Festas Espirituais</a>
      </nav>

      <div class="controls">
        <div class="search">
          <input id="q" type="search" placeholder="Buscar: recitativos, jovens, vila gl√≥ria, 19:30..." oninput="applyAllFilters()" />
        </div>
        <div class="helper">Dica: use ‚ÄúModo Idoso‚Äù e ‚ÄúAlto Contraste‚Äù nos bot√µes de baixo.</div>
      </div>

      <div class="quick" aria-label="A√ß√µes r√°pidas">
        <button class="qbtn primary" type="button" onclick="goToday()">üìÖ Hoje</button>
        <button class="qbtn ok" type="button" onclick="showNext()">‚úÖ Pr√≥ximo</button>
        <button class="qbtn warn" type="button" onclick="openHelp()">‚ùì Ajuda</button>
      </div>
    </div>

    <div class="section" id="cultos">
      <h3>Cultos e Reuni√µes</h3>

      <!-- Segunda -->
      <article class="daycard filterable" data-day="1" data-search="segunda-feira culto com recitativos vila limeira 19:30">
        <header class="dayhead">
          <div class="dayname">Segunda-Feira</div>
          <span class="badge" id="badge-1">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="19:30" data-rule="all"
               data-place="Vila Limeira" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos</div>
                <div class="place">Vila Limeira</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/YusVrwZBzGDUVTDDA?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Ter√ßa -->
      <article class="daycard filterable" data-day="2" data-search="ter√ßa-feira culto oficial vila gl√≥ria 19:30">
        <header class="dayhead">
          <div class="dayname">Ter√ßa-Feira</div>
          <span class="badge" id="badge-2">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="19:30" data-rule="all"
               data-place="Vila Gl√≥ria" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Vila Gl√≥ria</div>
                <div class="meta">
                  <a class="link" href="https://www.google.com/maps/search/?api=1&query=Vila%20Gl%C3%B3ria%2C%20Amambai%20MS" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Quarta -->
      <article class="daycard filterable" data-day="3" data-search="quarta-feira culto oficial central amambai 19:30">
        <header class="dayhead">
          <div class="dayname">Quarta-Feira</div>
          <span class="badge" id="badge-3">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="19:30" data-rule="all"
               data-place="Central Amambai" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Central Amambai</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/Epb62Fj31kdGPSA38?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Quinta -->
      <article class="daycard filterable" data-day="4" data-search="quinta-feira culto oficial vila limeira 19:30 culto com ensaio vila limeira 2¬∫ quinta do m√™s culto oficial aldeia amambai sert√£ozinho 19:30 culto com recitativos aldeia amambai sert√£ozinho 3¬∫ quinta do m√™s">
        <header class="dayhead">
          <div class="dayname">Quinta-Feira</div>
          <span class="badge" id="badge-4">Agenda</span>
        </header>
        <div class="items">
          <!-- Culto oficial (se aparecer junto com especial, o script oculta automaticamente no banner) -->
          <div class="item event" data-time="19:30" data-rule="all"
               data-place="Vila Limeira" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Vila Limeira</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/YusVrwZBzGDUVTDDA?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <!-- 2¬™ quinta do m√™s ‚Äî Culto com Ensaio Vila Limeira -->
          <div class="item event" data-time="19:30" data-rule="nth:2"
               data-place="Vila Limeira" data-title="Culto com Ensaio">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Ensaio <span class="tag">2¬∫ quinta do m√™s</span></div>
                <div class="place">Vila Limeira</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/YusVrwZBzGDUVTDDA?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <div class="item event" data-time="19:30" data-rule="all"
               data-place="Aldeia Amambai ‚Äî Sert√£ozinho" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Aldeia Amambai ‚Äî Sert√£ozinho</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/TxG7va8TKWiLDt549?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <!-- 3¬™ quinta do m√™s ‚Äî Recitativos Sert√£ozinho -->
          <div class="item event" data-time="19:30" data-rule="nth:3"
               data-place="Aldeia Amambai ‚Äî Sert√£ozinho" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos <span class="tag">3¬∫ quinta do m√™s</span></div>
                <div class="place">Aldeia Amambai ‚Äî Sert√£ozinho</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/TxG7va8TKWiLDt549?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Sexta -->
      <article class="daycard filterable" data-day="5" data-search="sexta-feira ensaio local central amambai 1¬∫ sexta do m√™s ensaio local vila gl√≥ria 3¬∫ sexta do m√™s ensaio local vila cristina 4¬∫ sexta do m√™s">
        <header class="dayhead">
          <div class="dayname">Sexta-Feira</div>
          <span class="badge" id="badge-5">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="19:30" data-rule="nth:1"
               data-place="Central Amambai" data-title="Ensaio Local">
            <div class="row">
              <div class="main">
                <div class="title">Ensaio Local <span class="tag">1¬∫ sexta do m√™s</span></div>
                <div class="place">Central Amambai</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/Epb62Fj31kdGPSA38?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <div class="item event" data-time="19:30" data-rule="nth:3"
               data-place="Vila Gl√≥ria" data-title="Ensaio Local">
            <div class="row">
              <div class="main">
                <div class="title">Ensaio Local <span class="tag">3¬∫ sexta do m√™s</span></div>
                <div class="place">Vila Gl√≥ria</div>
                <div class="meta">
                  <a class="link" href="https://www.google.com/maps/search/?api=1&query=Vila%20Gl%C3%B3ria%2C%20Amambai%20MS" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <div class="item event" data-time="19:30" data-rule="nth:4"
               data-place="Vila Cristina" data-title="Ensaio Local">
            <div class="row">
              <div class="main">
                <div class="title">Ensaio Local <span class="tag">4¬∫ sexta do m√™s</span></div>
                <div class="place">Vila Cristina</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/JwEQhcWKc7B3tKoa8?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- S√°bado -->
      <article class="daycard filterable" data-day="6" data-search="s√°bado reuni√£o de evangeliza√ß√£o pres√≠dio de amambai 09:00 reuni√£o de evangeliza√ß√£o lar do idoso 15:00 2¬∫ s√°bado do m√™s 4¬∫ s√°bado do m√™s culto oficial aldeia lim√£o verde 16:00 culto com recitativos aldeia amambai invernada i 18:30 2¬∫ s√°bado do m√™s culto oficial central amambai 19:30">
        <header class="dayhead">
          <div class="dayname">S√°bado</div>
          <span class="badge" id="badge-6">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="09:00" data-rule="all"
               data-place="Pres√≠dio de Amambai" data-title="Reuni√£o de Evangeliza√ß√£o">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Evangeliza√ß√£o</div>
                <div class="place">Pres√≠dio de Amambai</div>
                <div class="meta">
                  <a class="link" href="https://www.google.com/maps/search/?api=1&query=Pres%C3%ADdio%20de%20Amambai%2C%20Amambai%20MS" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">09:00</div>
            </div>
          </div>

          <div class="item event" data-time="15:00" data-rule="nth:2,4"
               data-place="Lar do Idoso" data-title="Reuni√£o de Evangeliza√ß√£o">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Evangeliza√ß√£o <span class="tag">2¬∫ s√°bado</span><span class="tag">4¬∫ s√°bado</span></div>
                <div class="place">Lar do Idoso</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/suCfJ3F4L6ziW6Np9?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">15:00</div>
            </div>
          </div>

          <div class="item event" data-time="16:00" data-rule="all"
               data-place="Aldeia Lim√£o Verde" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Aldeia Lim√£o Verde</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/uFACLakrJXSjUJLh6?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">16:00</div>
            </div>
          </div>

          <div class="item event" data-time="18:30" data-rule="nth:2"
               data-place="Aldeia Amambai ‚Äî Invernada I" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos <span class="tag">2¬∫ s√°bado</span></div>
                <div class="place">Aldeia Amambai ‚Äî Invernada I</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/m799Lv53BTgSxTVG7?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">18:30</div>
            </div>
          </div>

          <div class="item event" data-time="19:30" data-rule="all"
               data-place="Central Amambai" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Central Amambai</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/Epb62Fj31kdGPSA38?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Domingo -->
      <article class="daycard filterable" data-day="0" data-search="domingo reuni√£o de jovens e menores central amambai 09:30 reuni√£o de jovens e menores vila cristina 09:30 culto oficial aldeia amambai central 15:00 culto com recitativo aldeia amambai central 1¬∫ domingo e 3¬∫ domingo culto com recitativos vila gl√≥ria 19:00 culto oficial central amambai 19:00 culto oficial vila cristina 19:00 culto com ensaio aldeia amambai central 4¬∫ domingo">
        <header class="dayhead">
          <div class="dayname">Domingo</div>
          <span class="badge" id="badge-0">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="09:30" data-rule="all"
               data-place="Central Amambai" data-title="Reuni√£o de Jovens e Menores">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Jovens e Menores</div>
                <div class="place">Central Amambai</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/Epb62Fj31kdGPSA38?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">09:30</div>
            </div>
          </div>

          <div class="item event" data-time="09:30" data-rule="all"
               data-place="Vila Cristina" data-title="Reuni√£o de Jovens e Menores">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Jovens e Menores</div>
                <div class="place">Vila Cristina</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/JwEQhcWKc7B3tKoa8?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">09:30</div>
            </div>
          </div>

          <div class="item event" data-time="15:00" data-rule="all"
               data-place="Aldeia Amambai Central" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Aldeia Amambai Central</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/u2zTX6x2Pi6UmhJ66?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">15:00</div>
            </div>
          </div>

          <div class="item event" data-time="15:00" data-rule="nth:1,3"
               data-place="Aldeia Amambai Central" data-title="Culto com Recitativo">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativo <span class="tag">1¬∫ e 3¬∫ domingo</span></div>
                <div class="place">Aldeia Amambai Central</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/u2zTX6x2Pi6UmhJ66?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">15:00</div>
            </div>
          </div>

          <div class="item event" data-time="19:00" data-rule="all"
               data-place="Vila Gl√≥ria" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos</div>
                <div class="place">Vila Gl√≥ria</div>
                <div class="meta">
                  <a class="link" href="https://www.google.com/maps/search/?api=1&query=Vila%20Gl%C3%B3ria%2C%20Amambai%20MS" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:00</div>
            </div>
          </div>

          <div class="item event" data-time="19:00" data-rule="all"
               data-place="Central Amambai" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Central Amambai</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/Epb62Fj31kdGPSA38?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:00</div>
            </div>
          </div>

          <div class="item event" data-time="19:00" data-rule="all"
               data-place="Vila Cristina" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Vila Cristina</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/JwEQhcWKc7B3tKoa8?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">19:00</div>
            </div>
          </div>

          <div class="item event" data-time="15:00" data-rule="nth:4"
               data-place="Aldeia Amambai Central" data-title="Culto com Ensaio">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Ensaio <span class="tag">4¬∫ domingo</span></div>
                <div class="place">Aldeia Amambai Central</div>
                <div class="meta">
                  <a class="link" href="https://maps.app.goo.gl/u2zTX6x2Pi6UmhJ66?g_st=ic" target="_blank" rel="noopener">Abrir rota no Maps</a>
                </div>
              </div>
              <div class="time">15:00</div>
            </div>
          </div>
        </div>
      </article>
    </div>

    <div class="section" id="festas">
      <h3>Festas Espirituais</h3>
      <div class="tablecard filterable" id="festasCard">
        <div class="tablehead">
          <div class="t">Festas do bimestre</div>
          <div class="s">Se houver festa hoje, ela entra no c√°lculo do ‚Äúpr√≥ximo evento‚Äù.</div>
        </div>
        <div class="tablewrap">
          <table id="festasTable">
            <thead>
              <tr>
                <th style="min-width:180px;">Bimestre</th>
                <th style="min-width:120px;">Data</th>
                <th style="min-width:90px;">Hora</th>
                <th style="min-width:240px;">Festa</th>
                <th style="min-width:220px;">Congrega√ß√£o</th>
                <th style="min-width:220px;">Irm√£o que atender</th>
              </tr>
            </thead>
            <tbody>
              <tr class="festa" data-date="2026-02-21" data-time="19:30">
                <td class="emph">Janeiro e Fevereiro</td>
                <td>21/02/2026</td>
                <td>19:30</td>
                <td>Busca dos Dons</td>
                <td>Central Amambai</td>
                <td>Irm√£o Mois√©s Crepaldi</td>
              </tr>
              <tr class="festa" data-date="2026-02-26" data-time="19:30">
                <td class="emph">Janeiro e Fevereiro</td>
                <td>26/02/2026</td>
                <td>19:30</td>
                <td>Culto para Mocidade</td>
                <td>Aldeia Amambai ‚Äî Sert√£ozinho</td>
                <td>Irm√£o Jo√£o Butarelli</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <!-- Modal Ajuda -->
  <div class="modalBack" id="helpBack" onclick="closeHelp(event)">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Ajuda">
      <h4>Ajuda r√°pida</h4>
      <p>
        ‚Ä¢ Use <strong>Modo Idoso</strong> para letras maiores e bot√µes mais f√°ceis.<br>
        ‚Ä¢ Use <strong>Alto Contraste</strong> para melhorar a leitura.<br>
        ‚Ä¢ Em ‚ÄúPr√≥ximo‚Äù, mostramos o culto mais pr√≥ximo (ou o que est√° acontecendo agora).<br>
        ‚Ä¢ Em ‚ÄúHoje‚Äù, voc√™ vai direto na agenda do dia.
      </p>
      <div class="row">
        <button class="mBtn" type="button" onclick="closeHelp()">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Barra inferior estilo app -->
  <div class="bnav" role="navigation" aria-label="Menu do app">
    <div class="grid">
      <button class="primary" type="button" onclick="goToday()">
        <div class="icon">üìÖ</div><div>Hoje</div><div class="sub">Ir ao dia</div>
      </button>
      <button type="button" onclick="showNext()">
        <div class="icon">‚úÖ</div><div>Pr√≥ximo</div><div class="sub">Evento</div>
      </button>
      <button type="button" onclick="toggleElder()">
        <div class="icon">üîé</div><div>Modo Idoso</div><div class="sub" id="elderTxt">Desligado</div>
      </button>
      <button type="button" onclick="toggleContrast()">
        <div class="icon">‚ö°</div><div>Contraste</div><div class="sub" id="contrastTxt">Normal</div>
      </button>
      <button type="button" onclick="openHelp()">
        <div class="icon">‚ùì</div><div>Ajuda</div><div class="sub">Como usar</div>
      </button>
    </div>
  </div>

  <script>
    (function(){
      var THEME_KEY = "ccb_theme";
      var ELDER_KEY = "ccb_elder";
      var CONTRAST_KEY = "ccb_contrast";

      function byId(id){ return document.getElementById(id); }
      function text(el){ return (el && (el.innerText || el.textContent)) ? (el.innerText || el.textContent) : ""; }
      function trim(s){ return (s||"").replace(/^\s+|\s+$/g,""); }
      function pad2(n){ n=String(n); return (n.length<2)?("0"+n):n; }

      function minutesFromHHMM(hhmm){
        if(!hhmm) return null;
        var m = /^(\d{1,2}):(\d{2})$/.exec(hhmm);
        if(!m) return null;
        return parseInt(m[1],10)*60 + parseInt(m[2],10);
      }

      function toast(msg){
        var t = byId("toast");
        if(!t) return;
        t.textContent = msg;
        t.style.display = "block";
        if(window.__t){ clearTimeout(window.__t); }
        window.__t = setTimeout(function(){ t.style.display="none"; }, 2200);
      }

      function formatCountdown(mins){
        if(mins < 0) mins = 0;
        var h = Math.floor(mins/60);
        var m = mins % 60;
        if(h <= 0) return m + " min";
        return h + "h " + pad2(m) + "min";
      }

      var weekdayName = ["Domingo","Segunda-Feira","Ter√ßa-Feira","Quarta-Feira","Quinta-Feira","Sexta-Feira","S√°bado"];

      function safeStorageGet(key, fallback){
        try{ return localStorage.getItem(key) || fallback; }catch(e){ return fallback; }
      }
      function safeStorageSet(key, value){
        try{ localStorage.setItem(key, value); }catch(e){}
      }

      window.toggleTheme = function(){
        var cur = document.documentElement.getAttribute("data-theme") || "dark";
        var next = (cur === "dark") ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", next);
        safeStorageSet(THEME_KEY, next);
        var mt = byId("modeTxt");
        if(mt) mt.textContent = (next === "dark") ? "Modo escuro" : "Modo claro";
        toast(next === "dark" ? "Modo escuro ativado" : "Modo claro ativado");
      };

      function initTheme(){
        var saved = safeStorageGet(THEME_KEY, "dark");
        if(saved !== "dark" && saved !== "light") saved = "dark";
        document.documentElement.setAttribute("data-theme", saved);
        var mt = byId("modeTxt");
        if(mt) mt.textContent = (saved === "dark") ? "Modo escuro" : "Modo claro";
      }

      function initElder(){
        var v = safeStorageGet(ELDER_KEY, "0");
        document.documentElement.setAttribute("data-elder", v === "1" ? "1" : "0");
        var t = byId("elderTxt"); if(t) t.textContent = (v==="1" ? "Ligado" : "Desligado");
      }
      function initContrast(){
        var v = safeStorageGet(CONTRAST_KEY, "0");
        document.documentElement.setAttribute("data-contrast", v === "1" ? "1" : "0");
        var t = byId("contrastTxt"); if(t) t.textContent = (v==="1" ? "Alto" : "Normal");
      }

      window.toggleElder = function(){
        var cur = document.documentElement.getAttribute("data-elder") || "0";
        var next = (cur === "1") ? "0" : "1";
        document.documentElement.setAttribute("data-elder", next);
        safeStorageSet(ELDER_KEY, next);
        var t = byId("elderTxt"); if(t) t.textContent = (next==="1" ? "Ligado" : "Desligado");
        toast(next==="1" ? "Modo Idoso ligado" : "Modo Idoso desligado");
      };

      window.toggleContrast = function(){
        var cur = document.documentElement.getAttribute("data-contrast") || "0";
        var next = (cur === "1") ? "0" : "1";
        document.documentElement.setAttribute("data-contrast", next);
        safeStorageSet(CONTRAST_KEY, next);
        var t = byId("contrastTxt"); if(t) t.textContent = (next==="1" ? "Alto" : "Normal");
        toast(next==="1" ? "Alto contraste ligado" : "Contraste normal");
      };

      window.printPage = function(){
        try{ window.print(); }
        catch(e){ toast("Impress√£o n√£o dispon√≠vel aqui. Abra no Safari/Chrome."); }
      };

      window.shareOrCopy = function(){
        var url = (location && location.href) ? location.href : "";
        var title = document.title || "Agenda CCB";
        var msg = "Agenda: " + title;

        try{
          if(navigator && navigator.share){
            navigator.share({ title: title, text: msg, url: url }).catch(function(){});
            return;
          }
        }catch(e){}

        var toCopy = url ? url : msg;
        try{
          if(navigator && navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(toCopy).then(function(){ toast(url ? "Link copiado ‚úÖ" : "Texto copiado ‚úÖ"); })
              .catch(function(){ toast("N√£o consegui copiar. Copie o link da barra do navegador."); });
          } else {
            toast("Copie o link da barra do navegador.");
          }
        }catch(e){ toast("Copie o link da barra do navegador."); }
      };

      // ===== Regras (nth do m√™s por dia da semana) =====
      function weekOfMonth(date){
        var d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        var targetDow = d.getDay();
        var count = 0;
        for(var day=1; day<=d.getDate(); day++){
          var tmp = new Date(d.getFullYear(), d.getMonth(), day);
          if(tmp.getDay() === targetDow) count++;
        }
        return count; // 1..5
      }
      function ordinalPt(n, gender){ return (gender==="m") ? (n+"¬∫") : (n+"¬™"); }

      function ruleMatches(rule, nowDate){
        rule = (rule || "all").toLowerCase();
        if(rule === "all") return true;
        if(rule.indexOf("nth:") === 0){
          var nth = weekOfMonth(nowDate);
          var list = rule.replace("nth:","").split(",");
          for(var i=0;i<list.length;i++){
            if(parseInt(trim(list[i]),10) === nth) return true;
          }
          return false;
        }
        return true;
      }

      function applyRuleVisibility(){
        var now = new Date();
        var todayDow = now.getDay();
        var cards = document.querySelectorAll(".daycard");
        for(var c=0;c<cards.length;c++){
          var card = cards[c];
          var cardDow = parseInt(card.getAttribute("data-day"),10);
          var events = card.querySelectorAll(".event");
          for(var i=0;i<events.length;i++){
            var ev = events[i];
            var rule = (ev.getAttribute("data-rule") || "all").toLowerCase();

            // Eventos "all" aparecem sempre.
            if(rule === "all"){
              ev.style.display = "";
              continue;
            }

            // Eventos com regra (nth:...) s√≥ aparecem no card do dia de HOJE
            // e somente quando a semana do m√™s bate.
            if(cardDow === todayDow && ruleMatches(rule, now)){
              ev.style.display = "";
            } else {
              ev.style.display = "none";
            }
          }
        }
      }

      window.applyAllFilters = function(){
        applyRuleVisibility();
        var q = trim((byId("q") && byId("q").value) ? byId("q").value : "").toLowerCase();
        var cards = document.querySelectorAll(".daycard");
        for(var i=0;i<cards.length;i++){
          var card = cards[i];
          var hay = (card.getAttribute("data-search") || text(card)).toLowerCase();
          var show = true;
          if(q && hay.indexOf(q) === -1) show = false;
          card.style.display = show ? "" : "none";
        }
        var festaCard = byId("festasCard");
        var festaTrs = document.querySelectorAll("#festasTable tbody tr");
        var anyF=false;
        for(var k2=0;k2<festaTrs.length;k2++){
          var tr=festaTrs[k2];
          var fhay=(text(tr)).toLowerCase();
          var showF=true;
          if(q && fhay.indexOf(q)===-1) showF=false;
          tr.style.display = showF ? "" : "none";
          if(showF) anyF=true;
        }
        if(festaCard){
          if(q && !anyF) festaCard.style.display="none";
          else festaCard.style.display="";
        }
      };

      // Detecta se algum culto est√° "AGORA" (at√© 45 min depois do hor√°rio)
      function isNowEvent(evMin, nowMin){
        return nowMin >= evMin && nowMin <= (evMin + 45);
      }

      function updateHighlights(){
        applyRuleVisibility();

        var now = new Date();
        var day = now.getDay();
        var nowMin = now.getHours()*60 + now.getMinutes();
        var dd = pad2(now.getDate());
        var mm = pad2(now.getMonth()+1);
        var yyyy = now.getFullYear();
        var todayISO = yyyy + "-" + mm + "-" + dd;
        var todayDMY = dd + "/" + mm + "/" + yyyy;

        var clock = byId("clockChip");
        if(clock) clock.textContent = pad2(now.getHours()) + ":" + pad2(now.getMinutes());

        var weekChip = byId("weekChip");
        var nthToday = weekOfMonth(now);
        var dow = now.getDay();
        if(weekChip){
          weekChip.textContent = "Semana: " + ordinalPt(nthToday, "f") + " (" + weekdayName[dow] + ")";
        }

        // reset destaque
        var cards = document.querySelectorAll(".daycard");
        for(var i=0;i<cards.length;i++) cards[i].classList.remove("today");

        for(var b=0;b<7;b++){
          var bd=byId("badge-"+b);
          if(bd){ bd.classList.remove("today"); bd.textContent="Agenda"; }
        }

        var items = document.querySelectorAll(".event");
        for(var j=0;j<items.length;j++){
          items[j].classList.remove("next");
          items[j].classList.remove("past");
          items[j].classList.remove("now");
        }

        var todayCard = document.querySelector('.daycard[data-day="' + day + '"]');
        if(todayCard) todayCard.classList.add("today");
        var badge = byId("badge-"+day);
        if(badge){ badge.classList.add("today"); badge.textContent="Hoje"; }

        // eventos do dia (vis√≠veis + regras)
        var events = [];
        if(todayCard){
          var its = todayCard.querySelectorAll(".event");
          for(var k=0;k<its.length;k++){
            var it=its[k];
            if(it.style.display === "none") continue;

            var t=it.getAttribute("data-time")||"";
            var mins=minutesFromHHMM(t);
            if(mins!==null){
              var a = it.querySelector("a.link");
              var rule = (it.getAttribute("data-rule") || "").trim();
              if(rule && !ruleMatches(rule, now)) continue;

              events.push({
                type:"Culto ou Reuni√£o",
                mins:mins,
                timeText:t,
                title:it.getAttribute("data-title")||trim(text(it.querySelector(".title"))),
                place:it.getAttribute("data-place")||trim(text(it.querySelector(".place"))),
                maps: a ? a.href : "#",
                ref:it,
                isOfficial: (it.getAttribute("data-title")||"").toLowerCase().indexOf("culto oficial")>=0
              });
            }
          }
        }

        // festas do dia
        var trs = document.querySelectorAll("#festasTable tbody tr.festa");
        for(var f=0;f<trs.length;f++){
          var tr=trs[f];
          var d=trim(tr.getAttribute("data-date")||"");
          var t2=trim(tr.getAttribute("data-time")||"");
          if(d && d===todayISO){
            var mins2 = minutesFromHHMM(t2); if(mins2===null) mins2=0;
            var tds = tr.querySelectorAll("td");
            var place = trim(text(tds[4]));
            var maps = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(place + ", Amambai MS");
            events.push({
              type:"Festa Espiritual",
              mins:mins2,
              timeText:t2||"‚Äî",
              title:trim(text(tds[3])),
              place:place,
              maps:maps,
              ref:null,
              isOfficial:false
            });
          }
        }

        events.sort(function(a,b){ return a.mins-b.mins; });

        // 1) se existe evento "AGORA", ele vence
        var nowEv = null;
        for(var x=0;x<events.length;x++){
          if(isNowEvent(events[x].mins, nowMin)){ nowEv = events[x]; break; }
        }

        // 2) sen√£o, pega o pr√≥ximo >= agora
        var nextEv=null;
        if(!nowEv){
          for(var e=0;e<events.length;e++){
            if(events[e].mins>=nowMin){ nextEv=events[e]; break; }
          }
        }

        // Se existe um especial no mesmo hor√°rio, esconder "Culto Oficial" como candidato do banner
        function pickBannerCandidate(candidate){
          if(!candidate) return null;
          var sameTime = [];
          for(var i2=0;i2<events.length;i2++){
            if(events[i2].timeText === candidate.timeText && events[i2].mins === candidate.mins){
              sameTime.push(events[i2]);
            }
          }
          if(sameTime.length <= 1) return candidate;
          // se tem algum n√£o-oficial, preferir o n√£o-oficial
          for(var j2=0;j2<sameTime.length;j2++){
            if(!sameTime[j2].isOfficial) return sameTime[j2];
          }
          return candidate;
        }

        var bannerEv = pickBannerCandidate(nowEv || nextEv);

        // marca cards (past/next/now)
        for(var c=0;c<events.length;c++){
          if(events[c].ref){
            if(isNowEvent(events[c].mins, nowMin)) events[c].ref.classList.add("now");
            else if(events[c].mins < nowMin) events[c].ref.classList.add("past");
          }
        }
        if(bannerEv && bannerEv.ref){
          bannerEv.ref.classList.add(bannerEv === nowEv ? "now" : "next");
        }

        var big = byId("bannerBig");
        var small = byId("bannerSmall");
        var count = byId("countChip");
        var mapsChip = byId("mapsChip");

        if(big) big.textContent = "HOJE ‚Äî " + weekdayName[day] + " (" + todayDMY + ")";

        if(!events.length){
          if(small) small.textContent = "Nenhum evento cadastrado para hoje (ou n√£o h√° evento nesta semana do m√™s).";
          if(count) count.textContent = "Falta: ‚Äî";
          if(mapsChip) mapsChip.style.display="none";
          window.__nextInfo = null;
          return;
        }

        if(bannerEv){
          var left = bannerEv.mins - nowMin;
          if(nowEv){
            if(small) small.textContent = "AGORA: " + bannerEv.timeText + " ‚Äî " + bannerEv.title + " (" + bannerEv.place + ")";
            if(count) count.textContent = "Falta: ‚Äî";
          } else {
            if(small) small.textContent = "Pr√≥ximo: " + bannerEv.timeText + " ‚Äî " + bannerEv.title + " (" + bannerEv.place + ")";
            if(count) count.textContent = "Falta: " + formatCountdown(left);
          }
          if(mapsChip){
            mapsChip.style.display="inline-flex";
            mapsChip.href = bannerEv.maps || "#";
            mapsChip.textContent="Abrir no Maps";
          }
          window.__nextInfo = bannerEv;
        } else {
          if(small) small.textContent = "Hoje: eventos conclu√≠dos.";
          if(count) count.textContent = "Falta: 0 min";
          if(mapsChip) mapsChip.style.display="none";
          window.__nextInfo = null;
        }
      }

      // ===== Fun√ß√µes ‚Äúapp‚Äù =====
      window.goToday = function(){
        var now = new Date();
        var day = now.getDay();
        var todayCard = document.querySelector('.daycard[data-day="' + day + '"]');
        if(todayCard){
          todayCard.scrollIntoView({behavior:"smooth", block:"start"});
          toast("Indo para hoje‚Ä¶");
        } else {
          toast("N√£o achei o dia de hoje.");
        }
      };

      window.showNext = function(){
        updateHighlights();
        if(window.__nextInfo){
          toast((window.__nextInfo.type==="Festa Espiritual" ? "Festa: " : "Pr√≥ximo: ") + window.__nextInfo.title);
          if(window.__nextInfo.ref){
            window.__nextInfo.ref.scrollIntoView({behavior:"smooth", block:"center"});
          }
          return;
        }
        toast("Nenhum pr√≥ximo evento encontrado para hoje.");
      };

      window.openHelp = function(){
        var b = byId("helpBack");
        if(b){ b.style.display="flex"; }
      };
      window.closeHelp = function(ev){
        var b = byId("helpBack");
        if(!b) return;
        if(!ev || ev.target === b) b.style.display="none";
      };

      function init(){
        initTheme();
        initElder();
        initContrast();
        updateHighlights();
        applyAllFilters();
        setInterval(function(){ updateHighlights(); }, 60000);
      }
      init();
    })();
  </script>
</body>
</html>
