<body>
  <div class="container">
    <!-- LOGO OFICIAL CCB AMAMBAI -->
    <div class="logo-oficial">
      <div class="logo-principal">CCB</div>
      <div class="logo-secundario">CCB Amambai</div>
      <div class="logo-cidade">CongregaÃ§Ã£o CristÃ£ no Brasil</div>
      <div class="logo-cruz">â›ª</div>
    </div>

    <!-- HEADER -->
    <header class="header">
      <div class="header-info">
        <h2>Agenda Espiritual</h2>
        <p style="color: var(--text-muted);">Amambai - MS</p>
      </div>
      <div class="status">
        <div class="status-item" id="weather">
          <span>â˜€ï¸</span>
          <span id="temperature">--Â°C</span>
        </div>
        <div class="status-item" id="date-display">
          <span>ğŸ“…</span>
          <span id="current-date"></span>
        </div>
      </div>
    </header>

    <!-- BANNER PRINCIPAL -->
    <div class="banner" id="banner">
      <div>
        <div class="banner-title" id="banner-title">Carregando...</div>
        <div class="banner-subtitle" id="banner-subtitle"></div>
      </div>
      <button class="btn-icon" onclick="agenda.shareCurrent()">
        <span>ğŸ“¤</span>
        <span>Compartilhar</span>
      </button>
    </div>

    <!-- CONTROLES -->
    <div class="controls">
      <div class="search-container">
        <span class="search-icon">ğŸ”</span>
        <input type="search" class="search-input" id="search" placeholder="Buscar eventos, locais, horÃ¡rios..." autocomplete="off">
      </div>
      
      <div class="filters">
        <label class="toggle">
          <input type="checkbox" id="filter-today" onchange="agenda.toggleFilterToday()">
          <span class="toggle-slider"></span>
          <span>SÃ³ hoje</span>
        </label>
        
        <button class="btn-icon" onclick="agenda.toggleTheme()">
          <span id="theme-icon">ğŸŒ“</span>
          <span>Tema</span>
        </button>
        
        <button class="btn-icon" onclick="agenda.exportData()">
          <span>ğŸ“¥</span>
          <span>Exportar</span>
        </button>
      </div>
    </div>

    <!-- VIEW SELECTOR -->
    <div class="view-selector">
      <button class="view-btn active" onclick="agenda.setView('daily')">Dia</button>
      <button class="view-btn" onclick="agenda.setView('weekly')">Semana</button>
      <button class="view-btn" onclick="agenda.setView('monthly')">MÃªs</button>
    </div>

    <!-- DAILY VIEW -->
    <div id="daily-view" class="events-grid"></div>
    
    <!-- WEEKLY VIEW -->
    <div id="weekly-view" class="weekly-view" style="display: none;"></div>
    
    <!-- MONTHLY VIEW -->
    <div id="monthly-view" class="monthly-view" style="display: none;"></div>

    <!-- FESTAS ESPIRITUAIS -->
    <section class="festas-section">
      <h3>
        <span>â­</span>
        Festas Espirituais
        <span style="margin-left: auto; font-size: 0.9rem; color: var(--accent);" id="festas-count"></span>
      </h3>
      <div id="festas-grid" class="festas-grid"></div>
    </section>
  </div>

  <!-- FAB -->
  <button class="fab" onclick="agenda.goToToday()">
    <span class="fab-icon">ğŸ“Œ</span>
    <span>HOJE</span>
  </button>

  <!-- TOAST -->
  <div id="toast" class="toast"></div>

  <script>
    // AGENDA CCB AMAMBAI - VERSÃƒO COMPLETA
    class AgendaCCB {
      constructor() {
        this.dados = {
          cultos: [
            // Segunda-feira
            { id: '1', dia: 1, titulo: 'Culto com Recitativos', local: 'Vila Limeira', horario: '19:30', regra: 'all', semana: 'Todas', tipo: 'culto' },
            
            // TerÃ§a-feira
            { id: '2', dia: 2, titulo: 'Culto Oficial', local: 'Vila GlÃ³ria', horario: '19:30', regra: 'all', semana: 'Todas', tipo: 'culto' },
            
            // Quarta-feira
            { id: '3', dia: 3, titulo: 'Culto Oficial', local: 'Central Amambai', horario: '19:30', regra: 'all', semana: 'Todas', tipo: 'culto' },
            
            // Quinta-feira
            { id: '4', dia: 4, titulo: 'Culto Oficial', local: 'Vila Limeira', horario: '19:30', regra: 'all', semana: 'Todas', tipo: 'culto' },
            { id: '5', dia: 4, titulo: 'Culto com Ensaio', local: 'Vila Limeira', horario: '19:30', regra: 'nth:2', semana: '2Âª', tipo: 'especial' },
            { id: '6', dia: 4, titulo: 'Culto Oficial', local: 'Aldeia SertÃ£ozinho', horario: '19:30', regra: 'all', semana: 'Todas', tipo: 'culto' },
            { id: '7', dia: 4, titulo: 'Culto com Recitativos', local: 'Aldeia SertÃ£ozinho', horario: '19:30', regra: 'nth:3', semana: '3Âª', tipo: 'especial' },
            
            // Sexta-feira
            { id: '8', dia: 5, titulo: 'Ensaio Local', local: 'Central Amambai', horario: '19:30', regra: 'nth:1', semana: '1Âª', tipo: 'ensaio' },
            { id: '9', dia: 5, titulo: 'Ensaio Local', local: 'Vila Cristina', horario: '19:30', regra: 'nth:3', semana: '3Âª', tipo: 'ensaio' },
            { id: '10', dia: 5, titulo: 'Ensaio Local', local: 'Vila GlÃ³ria', horario: '19:30', regra: 'nth:4', semana: '4Âª', tipo: 'ensaio' },
            
            // SÃ¡bado
            { id: '11', dia: 6, titulo: 'ReuniÃ£o de EvangelizaÃ§Ã£o', local: 'PresÃ­dio de Amambai', horario: '09:00', regra: 'all', semana: 'Todas', tipo: 'evangelizacao' },
            { id: '12', dia: 6, titulo: 'ReuniÃ£o de EvangelizaÃ§Ã£o', local: 'Lar do Idoso', horario: '15:00', regra: 'nth:2,4', semana: '2Âª e 4Âª', tipo: 'evangelizacao' },
            { id: '13', dia: 6, titulo: 'Culto Oficial', local: 'Aldeia LimÃ£o Verde', horario: '16:00', regra: 'all', semana: 'Todas', tipo: 'culto' },
            { id: '14', dia: 6, titulo: 'Culto com Recitativos', local: 'Aldeia Amambai - Invernada I', horario: '18:30', regra: 'nth:2', semana: '2Âª', tipo: 'especial' },
            { id: '15', dia: 6, titulo: 'Culto Oficial', local: 'Central Amambai', horario: '19:30', regra: 'all', semana: 'Todas', tipo: 'culto' },
            
            // Domingo
            { id: '16', dia: 0, titulo: 'ReuniÃ£o de Jovens e Menores', local: 'Central Amambai', horario: '09:30', regra: 'all', semana: 'Todas', tipo: 'jovens' },
            { id: '17', dia: 0, titulo: 'ReuniÃ£o de Jovens e Menores', local: 'Vila Cristina', horario: '09:30', regra: 'all', semana: 'Todas', tipo: 'jovens' },
            { id: '18', dia: 0, titulo: 'Culto Oficial', local: 'Aldeia Amambai Central', horario: '15:00', regra: 'all', semana: 'Todas', tipo: 'culto' },
            { id: '19', dia: 0, titulo: 'Culto com Recitativo', local: 'Aldeia Amambai Central', horario: '15:00', regra: 'nth:1,3', semana: '1Âª e 3Âª', tipo: 'especial' },
            { id: '20', dia: 0, titulo: 'Culto com Ensaio', local: 'Aldeia Amambai Central', horario: '15:00', regra: 'nth:4', semana: '4Âª', tipo: 'especial' },
            { id: '21', dia: 0, titulo: 'Culto com Recitativos', local: 'Vila GlÃ³ria', horario: '19:00', regra: 'all', semana: 'Todas', tipo: 'culto' },
            { id: '22', dia: 0, titulo: 'Culto Oficial', local: 'Central Amambai', horario: '19:00', regra: 'all', semana: 'Todas', tipo: 'culto' },
            { id: '23', dia: 0, titulo: 'Culto Oficial', local: 'Vila Cristina', horario: '19:00', regra: 'all', semana: 'Todas', tipo: 'culto' }
          ],
          
          festas: [
            // Santa Ceia - Sempre 15 de cada mÃªs
            { id: 'f1', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-02-15', horario: '19:30', local: 'Central Amambai', irmao: 'MoisÃ©s Crepaldi' },
            { id: 'f3', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-03-15', horario: '19:30', local: 'Vila GlÃ³ria', irmao: 'Antonio Silva' },
            { id: 'f5', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-04-15', horario: '19:30', local: 'Vila Cristina', irmao: 'Pedro Santos' },
            { id: 'f7', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-05-15', horario: '19:30', local: 'Central Amambai', irmao: 'Lucas Rodrigues' },
            { id: 'f9', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-06-15', horario: '19:30', local: 'Vila Limeira', irmao: 'Marcos Paulo' },
            { id: 'f11', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-07-15', horario: '19:30', local: 'Aldeia Central', irmao: 'AndrÃ© Santos' },
            { id: 'f13', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-08-15', horario: '19:30', local: 'Vila GlÃ³ria', irmao: 'Felipe Souza' },
            
            // Batismo - Sempre 22 de cada mÃªs (uma semana apÃ³s Santa Ceia)
            { id: 'f2', tipo: 'batismo', titulo: 'Batismo', data: '2026-02-22', horario: '15:00', local: 'Vila Limeira', irmao: 'JoÃ£o Butarelli' },
            { id: 'f4', tipo: 'batismo', titulo: 'Batismo', data: '2026-03-22', horario: '15:00', local: 'Aldeia Central', irmao: 'JosÃ© Oliveira' },
            { id: 'f6', tipo: 'batismo', titulo: 'Batismo', data: '2026-04-22', horario: '15:00', local: 'Aldeia SertÃ£ozinho', irmao: 'Paulo Souza' },
            { id: 'f8', tipo: 'batismo', titulo: 'Batismo', data: '2026-05-22', horario: '15:00', local: 'Vila Cristina', irmao: 'Roberto Lima' },
            { id: 'f10', tipo: 'batismo', titulo: 'Batismo', data: '2026-06-22', horario: '15:00', local: 'Central Amambai', irmao: 'Carlos Alberto' },
            { id: 'f12', tipo: 'batismo', titulo: 'Batismo', data: '2026-07-22', horario: '15:00', local: 'Vila Limeira', irmao: 'Fernando Mendes' },
            { id: 'f14', tipo: 'batismo', titulo: 'Batismo', data: '2026-08-22', horario: '15:00', local: 'Aldeia Central', irmao: 'Ricardo Nunes' }
          ]
        };
        
        this.diasSemana = ['Domingo', 'Segunda', 'TerÃ§a', 'Quarta', 'Quinta', 'Sexta', 'SÃ¡bado'];
        this.diasAbrev = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'SÃ¡b'];
        this.meses = ['Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        
        this.viewAtual = 'daily';
        this.eventoAtual = null;
        this.proximoEvento = null;
        this.searchTimeout = null;
        
        this.init();
      }

      init() {
        this.carregarPreferencias();
        this.atualizarDataHora();
        this.atualizarClima();
        this.renderizar();
        this.configurarEventListeners();
        this.configurarAtalhos();
        this.iniciarAtualizacao();
      }

      carregarPreferencias() {
        const tema = localStorage.getItem('tema') || 'dark';
        document.documentElement.setAttribute('data-theme', tema);
      }

      atualizarDataHora() {
        const agora = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').textContent = agora.toLocaleDateString('pt-BR', options);
      }

      async atualizarClima() {
        try {
          const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=-23.1&longitude=-55.2&current_weather=true');
          const data = await response.json();
          const temp = Math.round(data.current_weather.temperature);
          document.getElementById('temperature').textContent = `${temp}Â°C`;
          
          const weatherCode = data.current_weather.weathercode;
          const icon = this.getWeatherIcon(weatherCode);
          document.querySelector('#weather span:first-child').textContent = icon;
        } catch (e) {
          const temp = Math.floor(Math.random() * 10 + 25);
          document.getElementById('temperature').textContent = `${temp}Â°C`;
        }
      }

      getWeatherIcon(code) {
        const icons = {
          0: 'â˜€ï¸', 1: 'ğŸŒ¤ï¸', 2: 'â›…', 3: 'â˜ï¸',
          45: 'ğŸŒ«ï¸', 48: 'ğŸŒ«ï¸', 51: 'ğŸŒ§ï¸', 61: 'ğŸŒ§ï¸',
          71: 'ğŸŒ¨ï¸', 95: 'â›ˆï¸'
        };
        return icons[code] || 'â˜€ï¸';
      }

      getSemanaDoMes() {
        const hoje = new Date();
        const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        const primeiroDiaSemana = primeiroDia.getDay();
        return Math.ceil((hoje.getDate() + primeiroDiaSemana) / 7);
      }

      eventoValido(evento) {
        if (evento.regra === 'all') return true;
        
        const semana = this.getSemanaDoMes();
        const semanas = evento.regra.replace('nth:', '').split(',').map(Number);
        
        return semanas.includes(semana);
      }

      filtrarEventos() {
        const termo = document.getElementById('search')?.value.toLowerCase() || '';
        const soHoje = document.getElementById('filter-today')?.checked || false;
        const hoje = new Date().getDay();
        
        return this.dados.cultos.filter(e => {
          if (termo) {
            const texto = `${e.titulo} ${e.local} ${e.horario}`.toLowerCase();
            if (!texto.includes(termo)) return false;
          }
          
          if (soHoje && e.dia !== hoje) return false;
          
          return this.eventoValido(e);
        }).sort((a, b) => a.horario.localeCompare(b.horario));
      }

      renderizar() {
        const eventos = this.filtrarEventos();
        const container = document.getElementById('daily-view');
        
        if (eventos.length === 0) {
          container.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
              <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ“­</div>
              <h3>Nenhum evento encontrado</h3>
              <p style="color: var(--text-muted);">Tente ajustar os filtros ou buscar por outros termos</p>
            </div>
          `;
        } else {
          container.innerHTML = eventos.map(e => this.criarCardEvento(e)).join('');
        }
        
        this.renderizarFestas();
        this.atualizarBanner();
        this.atualizarContadores();
      }

      criarCardEvento(e) {
        const agora = new Date();
        const [h, m] = e.horario.split(':').map(Number);
        const eventoHoje = new Date();
        eventoHoje.setHours(h, m, 0);
        
        const diffMin = (eventoHoje - agora) / (1000 * 60);
        const isNow = diffMin <= 45 && diffMin > -90;
        const isNext = diffMin > 0 && diffMin < 120;
        const isHoje = new Date().getDay() === e.dia;
        
        let tag = '';
        if (isNow) tag = '<span class="event-tag now">ğŸ”´ AGORA</span>';
        else if (isNext) tag = '<span class="event-tag" style="background: var(--warning);">â° PRÃ“XIMO</span>';
        else if (isHoje) tag = '<span class="event-tag">ğŸ“… HOJE</span>';
        
        return `
          <div class="event-card ${isNow ? 'now' : ''}" onclick="agenda.verDetalhesEvento('${e.id}')">
            ${tag}
            <div class="event-time">${e.horario}</div>
            ${e.semana !== 'Todas' ? `<div class="event-week">${e.semana} semana</div>` : ''}
            <div class="event-title">${e.titulo}</div>
            <div class="event-place">
              <span>ğŸ“</span>
              <span>${e.local}</span>
            </div>
          </div>
        `;
      }

      renderizarFestas() {
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0);
        
        const festasFuturas = this.dados.festas
          .filter(f => new Date(f.data) >= hoje)
          .sort((a, b) => new Date(a.data) - new Date(b.data));
        
        const container = document.getElementById('festas-grid');
        
        if (festasFuturas.length === 0) {
          container.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px;">
              <p style="color: var(--text-muted);">Nenhuma festa programada no momento</p>
            </div>
          `;
        } else {
          container.innerHTML = festasFuturas.map(f => {
            const dataFesta = new Date(f.data);
            const dataFormatada = dataFesta.toLocaleDateString('pt-BR');
            const tipoClass = f.tipo === 'santa-ceia' ? 'santa-ceia' : 'batismo';
            const tipoLabel = f.tipo === 'santa-ceia' ? 'ğŸ‡ Santa Ceia' : 'ğŸ’§ Batismo';
            
            return `
              <div class="festa-card" onclick="agenda.verDetalhesFesta('${f.id}')">
                <span class="festa-tipo ${tipoClass}">${tipoLabel}</span>
                <div class="festa-title">${f.titulo}</div>
                <div class="festa-data">ğŸ“… ${dataFormatada}</div>
                <div class="festa-detalhe">â° ${f.horario}</div>
                <div class="festa-detalhe">ğŸ“ ${f.local}</div>
                <div class="festa-detalhe">ğŸ‘¤ Ir. ${f.irmao}</div>
              </div>
            `;
          }).join('');
        }
        
        document.getElementById('festas-count').textContent = `${festasFuturas.length} festas`;
      }

      atualizarBanner() {
        const agora = new Date();
        const horaAtual = agora.getHours() * 60 + agora.getMinutes();
        const diaHoje = agora.getDay();
        
        const eventosHoje = this.dados.cultos.filter(e => 
          e.dia === diaHoje && this.eventoValido(e)
        );
        
        let eventoAtual = null;
        let eventoProximo = null;
        
        eventosHoje.forEach(e => {
          const [h, m] = e.horario.split(':').map(Number);
          const minutosEvento = h * 60 + m;
          
          if (minutosEvento <= horaAtual && horaAtual < minutosEvento + 90) {
            eventoAtual = e;
          } else if (minutosEvento > horaAtual && (!eventoProximo || minutosEvento < this.getMinutosEvento(eventoProximo))) {
            eventoProximo = e;
          }
        });
        
        const title = document.getElementById('banner-title');
        const subtitle = document.getElementById('banner-subtitle');
        
        if (eventoAtual) {
          title.textContent = `ğŸ”´ AGORA: ${eventoAtual.titulo}`;
          subtitle.textContent = `${eventoAtual.local} Â· atÃ© ${this.calcularFim(eventoAtual)}`;
        } else if (eventoProximo) {
          const diff = this.calcularDiferenca(eventoProximo);
          title.textContent = `â° PRÃ“XIMO: ${eventoProximo.titulo}`;
          subtitle.textContent = `${eventoProximo.local} Â· em ${diff}`;
        } else {
          title.textContent = 'ğŸ“… Nenhum evento hoje';
          subtitle.textContent = 'Volte amanhÃ£ para mais cultos';
        }
      }

      getMinutosEvento(e) {
        const [h, m] = e.horario.split(':').map(Number);
        return h * 60 + m;
      }

      calcularFim(e) {
        const [h, m] = e.horario.split(':').map(Number);
        const fimMin = h * 60 + m + 90;
        const fimH = Math.floor(fimMin / 60);
        const fimM = fimMin % 60;
        return `${fimH.toString().padStart(2, '0')}:${fimM.toString().padStart(2, '0')}`;
      }

      calcularDiferenca(e) {
        const agora = new Date();
        const [h, m] = e.horario.split(':').map(Number);
        const eventoHoje = new Date();
        eventoHoje.setHours(h, m, 0);
        
        const diffMin = Math.round((eventoHoje - agora) / (1000 * 60));
        
        if (diffMin < 60) return `${diffMin} min`;
        const horas = Math.floor(diffMin / 60);
        const minutos = diffMin % 60;
        return `${horas}h${minutos > 0 ? ` ${minutos}min` : ''}`;
      }

      atualizarContadores() {
        const totalEventos = this.dados.cultos.length;
        // Atualizar outros contadores se necessÃ¡rio
      }

      verDetalhesEvento(id) {
        const evento = this.dados.cultos.find(e => e.id === id);
        if (!evento) return;
        
        const agora = new Date();
        const [h, m] = evento.horario.split(':').map(Number);
        const eventoHoje = new Date();
        eventoHoje.setHours(h, m, 0);
        
        const diffMin = (eventoHoje - agora) / (1000 * 60);
        let status = '';
        
        if (diffMin <= 45 && diffMin > -90) {
          status = 'ğŸ”´ Acontecendo agora';
        } else if (diffMin > 0) {
          status = `â° ComeÃ§a em ${this.calcularDiferenca(evento)}`;
        } else {
          status = 'âœ… Evento jÃ¡ passou';
        }
        
        this.mostrarModal(`
          <h2 style="color: var(--accent); margin-bottom: 20px;">${evento.titulo}</h2>
          <p style="margin: 12px 0;"><strong>â° HorÃ¡rio:</strong> ${evento.horario}</p>
          <p style="margin: 12px 0;"><strong>ğŸ“ Local:</strong> ${evento.local}</p>
          <p style="margin: 12px 0;"><strong>ğŸ“… Dia:</strong> ${this.diasSemana[evento.dia]}</p>
          <p style="margin: 12px 0;"><strong>ğŸ”” Status:</strong> ${status}</p>
          ${evento.semana !== 'Todas' ? `<p style="margin: 12px 0;"><strong>ğŸ“Œ Semana:</strong> ${evento.semana}</p>` : ''}
        `, [
          { text: 'ğŸ“… CalendÃ¡rio', action: () => this.addToCalendar(evento), class: 'btn-primary' },
          { text: 'ğŸ“¤ Compartilhar', action: () => this.compartilharEvento(evento), class: 'btn-success' },
          { text: 'Fechar', action: 'close', class: 'btn-primary' }
        ]);
      }

      verDetalhesFesta(id) {
        const festa = this.dados.festas.find(f => f.id === id);
        if (!festa) return;
        
        const dataFesta = new Date(festa.data);
        const dataFormatada = dataFesta.toLocaleDateString('pt-BR', { 
          weekday: 'long', 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });
        
        this.mostrarModal(`
          <h2 style="color: var(--accent); margin-bottom: 20px;">${festa.titulo}</h2>
          <p style="margin: 12px 0;"><strong>ğŸ“… Data:</strong> ${dataFormatada}</p>
          <p style="margin: 12px 0;"><strong>â° HorÃ¡rio:</strong> ${festa.horario}</p>
          <p style="margin: 12px 0;"><strong>ğŸ“ Local:</strong> ${festa.local}</p>
          <p style="margin: 12px 0;"><strong>ğŸ‘¤ Pregador:</strong> Ir. ${festa.irmao}</p>
        `, [
          { text: 'ğŸ“¤ Compartilhar', action: () => this.compartilharFesta(festa), class: 'btn-success' },
          { text: 'Fechar', action: 'close', class: 'btn-primary' }
        ]);
      }

      mostrarModal(content, buttons = []) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const buttonsHtml = buttons.map(b => {
          if (b.action === 'close') {
            return `<button class="${b.class}" onclick="this.closest('.modal').remove()">${b.text}</button>`;
          } else {
            return `<button class="${b.class}" onclick="(${b.action})(); this.closest('.modal').remove()">${b.text}</button>`;
          }
        }).join('');
        
        modal.innerHTML = `
          <div class="modal-content">
            <div class="modal-header">
              <h2>Detalhes</h2>
              <button class="modal-close" onclick="this.closest('.modal').remove()">Ã—</button>
            </div>
            <div class="modal-body">
              ${content}
            </div>
            <div class="modal-footer">
              ${buttonsHtml}
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
      }

      addToCalendar(evento) {
        const texto = `${evento.titulo} em ${evento.local} Ã s ${evento.horario}`;
        navigator.clipboard.writeText(texto).then(() => {
          this.toast('âœ… Evento copiado! Cole no seu calendÃ¡rio');
        });
      }

      compartilharEvento(evento) {
        const texto = `*${evento.titulo}*\nğŸ“ ${evento.local}\nâ° ${evento.horario}\nğŸ“… ${this.diasSemana[evento.dia]}`;
        
        if (navigator.share) {
          navigator.share({ title: evento.titulo, text: texto });
        } else {
          navigator.clipboard.writeText(texto).then(() => {
            this.toast('âœ… Evento copiado!');
          });
        }
      }

      compartilharFesta(festa) {
        const dataFesta = new Date(festa.data).toLocaleDateString('pt-BR');
        const texto = `*${festa.titulo}*\nğŸ“… ${dataFesta}\nâ° ${festa.horario}\nğŸ“ ${festa.local}\nğŸ‘¤ Ir. ${festa.irmao}`;
        
        if (navigator.share) {
          navigator.share({ title: festa.titulo, text: texto });
        } else {
          navigator.clipboard.writeText(texto).then(() => {
            this.toast('âœ… Festa copiada!');
          });
        }
      }

      shareCurrent() {
        const hoje = new Date().getDay();
        const eventosHoje = this.dados.cultos.filter(e => e.dia === hoje && this.eventoValido(e));
        if (eventosHoje.length > 0) {
          this.compartilharEvento(eventosHoje[0]);
        }
      }

      toggleFilterToday() {
        this.renderizar();
      }

      toggleTheme() {
        const atual = document.documentElement.getAttribute('data-theme');
        const novo = atual === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', novo);
        localStorage.setItem('tema', novo);
        document.getElementById('theme-icon').textContent = novo === 'dark' ? 'ğŸŒ“' : 'â˜€ï¸';
        this.toast(`ğŸ¨ Modo ${novo === 'dark' ? 'escuro' : 'claro'}`);
      }

      exportData() {
        const dataStr = JSON.stringify(this.dados, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = `agenda-ccb-${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        this.toast('ğŸ“¥ Dados exportados!');
      }

      setView(view) {
        this.viewAtual = view;
        
        document.querySelectorAll('.view-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.textContent.toLowerCase().includes(view)) {
            btn.classList.add('active');
          }
        });
        
        document.getElementById('daily-view').style.display = view === 'daily' ? 'grid' : 'none';
        document.getElementById('weekly-view').style.display = view === 'weekly' ? 'grid' : 'none';
        document.getElementById('monthly-view').style.display = view === 'monthly' ? 'block' : 'none';
        
        if (view === 'weekly') this.renderizarWeekly();
        if (view === 'monthly') this.renderizarMonthly();
      }

      renderizarWeekly() {
        const container = document.getElementById('weekly-view');
        const hoje = new Date();
        const semana = [];
        
        for (let i = 0; i < 7; i++) {
          const data = new Date(hoje);
          data.setDate(hoje.getDate() + i);
          semana.push(data);
        }
        
        let html = '';
        semana.forEach((data, index) => {
          const diaSemana = data.getDay();
          const eventosDia = this.filtrarEventos().filter(e => e.dia === diaSemana);
          const isHoje = data.toDateString() === hoje.toDateString();
          
          html += `
            <div class="weekly-day ${isHoje ? 'today' : ''}">
              <div class="weekly-header">
                <div>${this.diasAbrev[diaSemana]}</div>
                <div class="weekly-date">${data.getDate()}</div>
              </div>
              ${eventosDia.map(e => `
                <div class="weekly-event" onclick="agenda.verDetalhesEvento('${e.id}')">
                  <strong>${e.horario}</strong><br>
                  ${e.titulo}<br>
                  <small>${e.local}</small>
                </div>
              `).join('')}
            </div>
          `;
        });
        
        container.innerHTML = html;
      }

      renderizarMonthly() {
        const container = document.getElementById('monthly-view');
        const hoje = new Date();
        const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        const ultimoDia = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
        
        let html = `
          <div class="month-header">
            ${this.diasAbrev.map(d => `<div>${d}</div>`).join('')}
          </div>
        `;
        
        let dias = [];
        
        for (let i = 0; i < primeiroDia.getDay(); i++) {
          dias.push('<div class="month-day"></div>');
        }
        
        for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
          const data = new Date(hoje.getFullYear(), hoje.getMonth(), dia);
          const diaSemana = data.getDay();
          const eventosDia = this.dados.cultos.filter(e => e.dia === diaSemana);
          const isHoje = data.toDateString() === hoje.toDateString();
          
          dias.push(`
            <div class="month-day ${isHoje ? 'today' : ''}">
              <div class="month-day-number">${dia}</div>
              ${eventosDia.slice(0, 2).map(e => `
                <div class="month-event ${e.tipo}" onclick="agenda.verDetalhesEvento('${e.id}')">
                  ${e.horario} ${e.titulo}
                </div>
              `).join('')}
              ${eventosDia.length > 2 ? `<div style="font-size: 0.7rem;">+${eventosDia.length - 2}</div>` : ''}
            </div>
          `);
        }
        
        while (dias.length % 7 !== 0) {
          dias.push('<div class="month-day"></div>');
        }
        
        for (let i = 0; i < dias.length; i += 7) {
          html += `<div class="month-week">${dias.slice(i, i + 7).join('')}</div>`;
        }
        
        container.innerHTML = html;
      }

      goToToday() {
        if (this.viewAtual !== 'daily') {
          this.setView('daily');
        }
        
        setTimeout(() => {
          const hoje = new Date().getDay();
          const cards = document.querySelectorAll('.event-card');
          for (let card of cards) {
            if (card.querySelector('.event-tag')?.textContent.includes('HOJE')) {
              card.scrollIntoView({ behavior: 'smooth', block: 'center' });
              break;
            }
          }
        }, 100);
        
        this.toast('ğŸ“Œ Rolando para hoje');
      }

      configurarEventListeners() {
        document.getElementById('search').addEventListener('input', (e) => {
          clearTimeout(this.searchTimeout);
          this.searchTimeout = setTimeout(() => {
            this.renderizar();
          }, 300);
        });
      }

      configurarAtalhos() {
        document.addEventListener('keydown', (e) => {
          if (e.key === '/' && !e.ctrlKey) {
            e.preventDefault();
            document.getElementById('search').focus();
          }
          
          if (e.key === 'Escape') {
            document.getElementById('search').value = '';
            this.renderizar();
          }
          
          if (e.altKey && e.key >= '1' && e.key <= '3') {
            const views = ['daily', 'weekly', 'monthly'];
            this.setView(views[parseInt(e.key) - 1]);
          }
          
          if (e.altKey && e.key === 't') {
            this.toggleTheme();
          }
          
          if (e.altKey && e.key === 'h') {
            this.goToToday();
          }
        });
      }

      iniciarAtualizacao() {
        setInterval(() => {
          this.atualizarBanner();
        }, 60000);
        
        setInterval(() => {
          this.atualizarClima();
        }, 1800000);
      }

      toast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
      }
    }

    // Inicializar a agenda
    const agenda = new AgendaCCB();
  </script>
</body>
</html>
