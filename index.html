<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>CCB Amambai ‚Äî Agenda Espiritual</title>
  
  <!-- PWA Meta Tags -->
  <link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22CCB%20Amambai%22%2C%22short_name%22%3A%22CCB%20Amambai%22%2C%22description%22%3A%22Cultos%2C%20Reuni%C3%B5es%20e%20Festas%20Espirituais%22%2C%22start_url%22%3A%22%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%230f172a%22%2C%22theme_color%22%3A%22%230f172a%22%7D">
  <meta name="theme-color" content="#0f172a">
  
  <style>
    /* RESET E VARI√ÅVEIS */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0b1220;
      --card: #0b152a;
      --text: #e5e7eb;
      --text-muted: #94a3b8;
      --accent: #38bdf8;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --border: rgba(148, 163, 184, 0.22);
      --glass: rgba(15, 23, 42, 0.55);
      --shadow: 0 14px 28px rgba(0, 0, 0, 0.28);
      --radius: 18px;
      --transition: all 0.3s ease;
    }

    [data-theme="light"] {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --text-muted: #475569;
      --accent: #0ea5e9;
      --border: #e2e8f0;
      --glass: rgba(255, 255, 255, 0.78);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: var(--transition);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 20px 90px;
    }

    /* LOGO OFICIAL CCB AMAMBAI */
    .logo-oficial {
      background: linear-gradient(135deg, #0f172a, #1e293b);
      border: 2px solid var(--accent);
      border-radius: 30px;
      padding: 25px 20px;
      margin-bottom: 25px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(56, 189, 248, 0.3);
      position: relative;
      overflow: hidden;
    }

    .logo-oficial::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(56,189,248,0.15) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
    }

    .logo-principal {
      font-family: 'Times New Roman', serif;
      font-size: 5rem;
      font-weight: 900;
      letter-spacing: 8px;
      color: var(--accent);
      text-shadow: 0 0 30px rgba(56, 189, 248, 0.5);
      line-height: 1;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    .logo-secundario {
      font-family: 'Times New Roman', serif;
      font-size: 2.2rem;
      font-weight: 600;
      letter-spacing: 4px;
      color: white;
      margin-top: 5px;
      position: relative;
      z-index: 1;
    }

    .logo-cidade {
      font-size: 1.3rem;
      color: var(--text-muted);
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(56, 189, 248, 0.3);
      position: relative;
      z-index: 1;
    }

    .logo-cruz {
      font-size: 2rem;
      margin-top: 10px;
      color: var(--accent);
      animation: pulse 2s infinite;
      position: relative;
      z-index: 1;
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .status {
      display: flex;
      gap: 16px;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(56, 189, 248, 0.1);
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 999px;
      font-size: 0.9rem;
    }

    /* BANNER */
    .banner {
      background: linear-gradient(135deg, 
        rgba(56, 189, 248, 0.2), 
        rgba(34, 197, 94, 0.2));
      border: 1px solid var(--accent);
      border-radius: var(--radius);
      padding: 20px 24px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .banner-title {
      font-size: 1.3rem;
      font-weight: 700;
    }

    .banner-subtitle {
      color: var(--text-muted);
    }

    /* CONTROLES */
    .controls {
      padding: 20px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .search-input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 999px;
      color: var(--text);
      font-size: 1rem;
      margin-bottom: 16px;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .filters {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .toggle input {
      display: none;
    }

    .toggle-slider {
      width: 50px;
      height: 24px;
      background: var(--border);
      border-radius: 999px;
      position: relative;
    }

    .toggle-slider:before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: var(--transition);
    }

    .toggle input:checked + .toggle-slider {
      background: var(--accent);
    }

    .toggle input:checked + .toggle-slider:before {
      left: 28px;
    }

    .btn-icon {
      padding: 8px 16px;
      border: 1px solid var(--border);
      background: var(--glass);
      color: var(--text);
      border-radius: 999px;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-icon:hover {
      background: var(--accent);
      color: white;
    }

    /* VIEW SELECTOR */
    .view-selector {
      display: flex;
      gap: 8px;
      padding: 4px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 999px;
      margin-bottom: 20px;
      width: fit-content;
    }

    .view-btn {
      padding: 8px 20px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: 999px;
      font-weight: 600;
    }

    .view-btn.active {
      background: var(--accent);
      color: white;
    }

    /* EVENT CARDS */
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .event-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      transition: var(--transition);
      position: relative;
      cursor: pointer;
    }

    .event-card:hover {
      transform: translateY(-4px);
      border-color: var(--accent);
    }

    .event-card.now {
      border-color: var(--success);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
    }

    .event-tag {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      background: var(--accent);
      color: white;
    }

    .event-tag.now {
      background: var(--success);
    }

    .event-time {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .event-week {
      display: inline-block;
      padding: 4px 8px;
      background: rgba(56, 189, 248, 0.1);
      border-radius: 4px;
      font-size: 0.8rem;
      margin-bottom: 8px;
    }

    /* FESTAS */
    .festas-section {
      padding: 20px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-top: 30px;
      backdrop-filter: blur(10px);
    }

    .festas-section h3 {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      font-size: 1.3rem;
    }

    .festas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .festa-card {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(34, 197, 94, 0.1));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      transition: var(--transition);
      cursor: pointer;
    }

    .festa-card.passada {
      opacity: 0.5;
      filter: grayscale(0.7);
      pointer-events: none;
    }

    .festa-card:hover:not(.passada) {
      transform: translateY(-4px);
      border-color: var(--accent);
    }

    .festa-tipo {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .festa-tipo.santa-ceia {
      background: rgba(249, 115, 22, 0.2);
      color: #f97316;
    }

    .festa-tipo.batismo {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .festa-data {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 8px 0;
    }

    .festa-passada-badge {
      display: inline-block;
      margin-left: 8px;
      padding: 2px 8px;
      background: var(--danger);
      border-radius: 999px;
      font-size: 0.7rem;
      color: white;
    }

    /* CALEND√ÅRIO MENSAL */
    .monthly-view {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 30px;
    }

    .month-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background: var(--accent);
      color: white;
      padding: 12px;
      text-align: center;
      font-weight: 700;
    }

    .month-week {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .month-day {
      min-height: 100px;
      padding: 8px;
      border: 1px solid var(--border);
    }

    .month-day.today {
      background: rgba(56, 189, 248, 0.1);
    }

    .month-day-number {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .month-event {
      font-size: 0.7rem;
      padding: 2px 4px;
      margin-bottom: 2px;
      border-radius: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .month-event.culto { background: rgba(56, 189, 248, 0.3); }
    .month-event.festa { background: rgba(34, 197, 94, 0.3); }
    .month-event.especial { background: rgba(249, 115, 22, 0.3); }

    /* FAB */
    .fab {
      position: fixed;
      right: 24px;
      bottom: 24px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 14px 28px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(56, 189, 248, 0.3);
      transition: var(--transition);
      z-index: 100;
    }

    .fab:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(56, 189, 248, 0.5);
    }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card);
      border-left: 4px solid var(--success);
      border-radius: 8px;
      padding: 12px 24px;
      color: var(--text);
      box-shadow: var(--shadow);
      z-index: 1000;
      display: none;
    }

    .toast.show {
      display: block;
    }

    /* ANIMA√á√ïES */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .logo-principal { font-size: 3.5rem; }
      .logo-secundario { font-size: 1.8rem; }
      .fab span:not(.fab-icon) { display: none; }
      .fab { padding: 14px; border-radius: 50%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGO OFICIAL CCB AMAMBAI -->
    <div class="logo-oficial">
      <div class="logo-principal">CCB</div>
      <div class="logo-secundario">CCB Amambai</div>
      <div class="logo-cidade">Congrega√ß√£o Crist√£ no Brasil</div>
      <div class="logo-cruz">‚õ™</div>
    </div>

    <!-- HEADER -->
    <header class="header">
      <div>
        <h2>Agenda Espiritual</h2>
        <p style="color: var(--text-muted);">Amambai - MS</p>
      </div>
      <div class="status">
        <div class="status-item" id="weather">‚òÄÔ∏è <span id="temperature">--¬∞C</span></div>
        <div class="status-item" id="date-display">üìÖ <span id="current-date"></span></div>
      </div>
    </header>

    <!-- BANNER -->
    <div class="banner" id="banner">
      <div>
        <div class="banner-title" id="banner-title">Carregando...</div>
        <div class="banner-subtitle" id="banner-subtitle"></div>
      </div>
      <button class="btn-icon" onclick="agenda.shareCurrent()">üì§ Compartilhar</button>
    </div>

    <!-- CONTROLES -->
    <div class="controls">
      <input type="search" class="search-input" id="search" placeholder="Buscar eventos, locais, hor√°rios..." oninput="agenda.buscar()">
      
      <div class="filters">
        <label class="toggle">
          <input type="checkbox" id="filter-today" onchange="agenda.toggleFilterToday()">
          <span class="toggle-slider"></span>
          <span>S√≥ hoje</span>
        </label>
        
        <button class="btn-icon" onclick="agenda.toggleTema()">üåì Tema</button>
      </div>
    </div>

    <!-- VIEW SELECTOR -->
    <div class="view-selector">
      <button class="view-btn active" onclick="agenda.setView('daily')">Dia</button>
      <button class="view-btn" onclick="agenda.setView('weekly')">Semana</button>
      <button class="view-btn" onclick="agenda.setView('monthly')">M√™s</button>
    </div>

    <!-- DAILY VIEW -->
    <div id="daily-view" class="events-grid"></div>
    
    <!-- WEEKLY VIEW -->
    <div id="weekly-view" class="weekly-view" style="display: none;"></div>
    
    <!-- MONTHLY VIEW -->
    <div id="monthly-view" class="monthly-view" style="display: none;"></div>

    <!-- FESTAS ESPIRITUAIS -->
    <section class="festas-section">
      <h3>
        <span>‚≠ê</span>
        Festas Espirituais
        <span style="margin-left: auto;" id="festas-count"></span>
      </h3>
      <div id="festas-grid" class="festas-grid"></div>
    </section>
  </div>

  <!-- FAB -->
  <button class="fab" onclick="agenda.irParaHoje()">üìå HOJE</button>

  <!-- TOAST -->
  <div id="toast" class="toast"></div>

  <script>
    class AgendaCCB {
      constructor() {
        this.dados = {
          cultos: [
            // Segunda
            { id: '1', dia: 1, titulo: 'Culto com Recitativos', local: 'Vila Limeira', horario: '19:30', regra: 'all', semana: 'Todas', tipo: 'culto' },
            // Ter√ßa
            { id: '2', dia: 2, titulo: 'Culto Oficial', local: 'Vila Gl√≥ria', horario: '19:30', regra: 'all', tipo: 'culto' },
            // Quarta
            { id: '3', dia: 3, titulo: 'Culto Oficial', local: 'Central Amambai', horario: '19:30', regra: 'all', tipo: 'culto' },
            // Quinta
            { id: '4', dia: 4, titulo: 'Culto Oficial', local: 'Vila Limeira', horario: '19:30', regra: 'all', tipo: 'culto' },
            { id: '5', dia: 4, titulo: 'Culto com Ensaio', local: 'Vila Limeira', horario: '19:30', regra: 'nth:2', semana: '2¬™', tipo: 'especial' },
            { id: '6', dia: 4, titulo: 'Culto Oficial', local: 'Aldeia Sert√£ozinho', horario: '19:30', regra: 'all', tipo: 'culto' },
            { id: '7', dia: 4, titulo: 'Culto com Recitativos', local: 'Aldeia Sert√£ozinho', horario: '19:30', regra: 'nth:3', semana: '3¬™', tipo: 'especial' },
            // Sexta
            { id: '8', dia: 5, titulo: 'Ensaio Local', local: 'Central Amambai', horario: '19:30', regra: 'nth:1', semana: '1¬™', tipo: 'ensaio' },
            { id: '9', dia: 5, titulo: 'Ensaio Local', local: 'Vila Cristina', horario: '19:30', regra: 'nth:3', semana: '3¬™', tipo: 'ensaio' },
            { id: '10', dia: 5, titulo: 'Ensaio Local', local: 'Vila Gl√≥ria', horario: '19:30', regra: 'nth:4', semana: '4¬™', tipo: 'ensaio' },
            // S√°bado
            { id: '11', dia: 6, titulo: 'Evangeliza√ß√£o', local: 'Pres√≠dio', horario: '09:00', regra: 'all', tipo: 'evangelizacao' },
            { id: '12', dia: 6, titulo: 'Evangeliza√ß√£o', local: 'Lar do Idoso', horario: '15:00', regra: 'nth:2,4', semana: '2¬™ e 4¬™', tipo: 'evangelizacao' },
            { id: '13', dia: 6, titulo: 'Culto Oficial', local: 'Aldeia Lim√£o Verde', horario: '16:00', regra: 'all', tipo: 'culto' },
            { id: '14', dia: 6, titulo: 'Culto com Recitativos', local: 'Aldeia Invernada', horario: '18:30', regra: 'nth:2', semana: '2¬™', tipo: 'especial' },
            { id: '15', dia: 6, titulo: 'Culto Oficial', local: 'Central Amambai', horario: '19:30', regra: 'all', tipo: 'culto' },
            // Domingo
            { id: '16', dia: 0, titulo: 'Jovens e Menores', local: 'Central Amambai', horario: '09:30', regra: 'all', tipo: 'jovens' },
            { id: '17', dia: 0, titulo: 'Jovens e Menores', local: 'Vila Cristina', horario: '09:30', regra: 'all', tipo: 'jovens' },
            { id: '18', dia: 0, titulo: 'Culto Oficial', local: 'Aldeia Central', horario: '15:00', regra: 'all', tipo: 'culto' },
            { id: '19', dia: 0, titulo: 'Culto com Recitativo', local: 'Aldeia Central', horario: '15:00', regra: 'nth:1,3', semana: '1¬™ e 3¬™', tipo: 'especial' },
            { id: '20', dia: 0, titulo: 'Culto com Ensaio', local: 'Aldeia Central', horario: '15:00', regra: 'nth:4', semana: '4¬™', tipo: 'especial' },
            { id: '21', dia: 0, titulo: 'Culto com Recitativos', local: 'Vila Gl√≥ria', horario: '19:00', regra: 'all', tipo: 'culto' },
            { id: '22', dia: 0, titulo: 'Culto Oficial', local: 'Central Amambai', horario: '19:00', regra: 'all', tipo: 'culto' },
            { id: '23', dia: 0, titulo: 'Culto Oficial', local: 'Vila Cristina', horario: '19:00', regra: 'all', tipo: 'culto' }
          ],
          
          festas: [
            { id: 'f1', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-02-15', horario: '19:30', local: 'Central Amambai', irmao: 'Mois√©s Crepaldi' },
            { id: 'f2', tipo: 'batismo', titulo: 'Batismo', data: '2026-02-22', horario: '15:00', local: 'Vila Limeira', irmao: 'Jo√£o Butarelli' },
            { id: 'f3', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-03-15', horario: '19:30', local: 'Vila Gl√≥ria', irmao: 'Antonio Silva' },
            { id: 'f4', tipo: 'batismo', titulo: 'Batismo', data: '2026-03-22', horario: '15:00', local: 'Aldeia Central', irmao: 'Jos√© Oliveira' },
            { id: 'f5', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-04-19', horario: '19:30', local: 'Vila Cristina', irmao: 'Pedro Santos' },
            { id: 'f6', tipo: 'batismo', titulo: 'Batismo', data: '2026-04-26', horario: '15:00', local: 'Aldeia Sert√£ozinho', irmao: 'Paulo Souza' },
            { id: 'f7', tipo: 'santa-ceia', titulo: 'Santa Ceia', data: '2026-05-17', horario: '19:30', local: 'Central Amambai', irmao: 'Lucas Rodrigues' },
            { id: 'f8', tipo: 'batismo', titulo: 'Batismo', data: '2026-05-24', horario: '15:00', local: 'Vila Limeira', irmao: 'Marcos Oliveira' }
          ]
        };
        
        this.diasSemana = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
        this.viewAtual = 'daily';
        
        this.init();
      }

      init() {
        this.atualizarData();
        this.renderizar();
        this.configurarAtalhos();
        setInterval(() => this.atualizarBanner(), 60000);
      }

      atualizarData() {
        const agora = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').textContent = agora.toLocaleDateString('pt-BR', options);
        document.getElementById('temperature').textContent = Math.floor(Math.random() * 10 + 25) + '¬∞C';
      }

      getSemanaDoMes() {
        const hoje = new Date();
        const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        return Math.ceil((hoje.getDate() + primeiroDia.getDay()) / 7);
      }

      eventoValido(evento) {
        if (evento.regra === 'all') return true;
        const semana = this.getSemanaDoMes();
        const semanas = evento.regra.replace('nth:', '').split(',').map(Number);
        return semanas.includes(semana);
      }

      filtrarEventos() {
        const termo = document.getElementById('search')?.value.toLowerCase() || '';
        const soHoje = document.getElementById('filter-today')?.checked || false;
        const hoje = new Date().getDay();
        
        return this.dados.cultos.filter(e => {
          if (termo && !`${e.titulo} ${e.local}`.toLowerCase().includes(termo)) return false;
          if (soHoje && e.dia !== hoje) return false;
          return this.eventoValido(e);
        });
      }

      renderizar() {
        const eventos = this.filtrarEventos();
        const container = document.getElementById('daily-view');
        
        container.innerHTML = eventos.map(e => this.criarCard(e)).join('');
        this.renderizarFestas();
        this.atualizarBanner();
      }

      criarCard(e) {
        const agora = new Date();
        const [h, m] = e.horario.split(':').map(Number);
        const eventoHoje = new Date();
        eventoHoje.setHours(h, m, 0);
        const diff = (eventoHoje - agora) / (1000 * 60);
        const isNow = diff <= 45 && diff > -90;
        
        return `
          <div class="event-card ${isNow ? 'now' : ''}" onclick="agenda.verDetalhes('${e.id}')">
            ${isNow ? '<span class="event-tag now">üî¥ AGORA</span>' : 
              new Date().getDay() === e.dia ? '<span class="event-tag">üìÖ HOJE</span>' : ''}
            <div class="event-time">${e.horario}</div>
            ${e.semana ? `<div class="event-week">${e.semana} semana</div>` : ''}
            <h3>${e.titulo}</h3>
            <p style="color: var(--text-muted);">üìç ${e.local}</p>
          </div>
        `;
      }

      renderizarFestas() {
        const hoje = new Date();
        const festasContainer = document.getElementById('festas-grid');
        
        const festasFiltradas = this.dados.festas.filter(f => new Date(f.data) >= hoje);
        
        festasContainer.innerHTML = festasFiltradas.map(f => {
          const dataFesta = new Date(f.data);
          const tipoClass = f.tipo === 'santa-ceia' ? 'santa-ceia' : 'batismo';
          const tipoLabel = f.tipo === 'santa-ceia' ? 'üçá Santa Ceia' : 'üíß Batismo';
          
          return `
            <div class="festa-card" onclick="agenda.verDetalhesFesta('${f.id}')">
              <span class="festa-tipo ${tipoClass}">${tipoLabel}</span>
              <h4 class="festa-title">${f.titulo}</h4>
              <div class="festa-data">üìÖ ${dataFesta.toLocaleDateString('pt-BR')}</div>
              <p>‚è∞ ${f.horario}</p>
              <p>üìç ${f.local}</p>
              <p>üë§ Ir. ${f.irmao}</p>
            </div>
          `;
        }).join('');
        
        document.getElementById('festas-count').textContent = `${festasFiltradas.length} festas`;
      }

      atualizarBanner() {
        const agora = new Date();
        const horaAtual = agora.getHours() * 60 + agora.getMinutes();
        const eventosHoje = this.dados.cultos.filter(e => e.dia === agora.getDay() && this.eventoValido(e));
        
        let eventoAtual = null;
        let eventoProximo = null;
        
        eventosHoje.forEach(e => {
          const [h, m] = e.horario.split(':').map(Number);
          const minutos = h * 60 + m;
          
          if (minutos <= horaAtual && horaAtual < minutos + 90) {
            eventoAtual = e;
          } else if (minutos > horaAtual && (!eventoProximo || minutos < parseInt(eventoProximo.horario.split(':')[0]) * 60 + parseInt(eventoProximo.horario.split(':')[1]))) {
            eventoProximo = e;
          }
        });
        
        if (eventoAtual) {
          document.getElementById('banner-title').textContent = `üî¥ AGORA: ${eventoAtual.titulo}`;
          document.getElementById('banner-subtitle').textContent = eventoAtual.local;
        } else if (eventoProximo) {
          document.getElementById('banner-title').textContent = `‚è∞ PR√ìXIMO: ${eventoProximo.titulo}`;
          document.getElementById('banner-subtitle').textContent = `${eventoProximo.local} √†s ${eventoProximo.horario}`;
        } else {
          document.getElementById('banner-title').textContent = 'üìÖ Nenhum evento hoje';
          document.getElementById('banner-subtitle').textContent = 'Volte amanh√£';
        }
      }

      verDetalhes(id) {
        const evento = this.dados.cultos.find(e => e.id === id);
        alert(`${evento.titulo}\nüìç ${evento.local}\n‚è∞ ${evento.horario}\nüìÖ ${this.diasSemana[evento.dia]}`);
      }

      verDetalhesFesta(id) {
        const festa = this.dados.festas.find(f => f.id === id);
        alert(`üéâ ${festa.titulo}\nüìÖ ${new Date(festa.data).toLocaleDateString('pt-BR')}\n‚è∞ ${festa.horario}\nüìç ${festa.local}\nüë§ Ir. ${festa.irmao}`);
      }

      buscar() {
        this.renderizar();
      }

      toggleFilterToday() {
        this.renderizar();
      }

      toggleTema() {
        const atual = document.documentElement.getAttribute('data-theme');
        const novo = atual === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', novo);
        localStorage.setItem('tema', novo);
        this.toast(`Tema ${novo}`);
      }

      setView(view) {
        this.viewAtual = view;
        document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        document.getElementById('daily-view').style.display = view === 'daily' ? 'grid' : 'none';
        document.getElementById('weekly-view').style.display = view === 'weekly' ? 'grid' : 'none';
        document.getElementById('monthly-view').style.display = view === 'monthly' ? 'block' : 'none';
        
        if (view === 'weekly') this.renderizarWeekly();
        if (view === 'monthly') this.renderizarMonthly();
      }

      renderizarWeekly() {
        const container = document.getElementById('weekly-view');
        container.innerHTML = '<p style="grid-column: span 7; text-align: center;">Visualiza√ß√£o semanal em breve</p>';
      }

      renderizarMonthly() {
        const container = document.getElementById('monthly-view');
        const hoje = new Date();
        const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        const ultimoDia = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
        
        let html = `<div class="month-header">${this.diasAbrev.map(d => `<div>${d}</div>`).join('')}</div>`;
        let dias = [];
        
        for (let i = 0; i < primeiroDia.getDay(); i++) {
          dias.push('<div class="month-day"></div>');
        }
        
        for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
          const data = new Date(hoje.getFullYear(), hoje.getMonth(), dia);
          const diaSemana = data.getDay();
          const isHoje = data.toDateString() === hoje.toDateString();
          const eventosDia = this.dados.cultos.filter(e => e.dia === diaSemana);
          
          dias.push(`
            <div class="month-day ${isHoje ? 'today' : ''}">
              <div class="month-day-number">${dia}</div>
              ${eventosDia.slice(0, 2).map(e => 
                `<div class="month-event ${e.tipo}">${e.horario} ${e.titulo}</div>`
              ).join('')}
            </div>
          `);
        }
        
        for (let i = 0; i < dias.length; i += 7) {
          html += `<div class="month-week">${dias.slice(i, i + 7).join('')}</div>`;
        }
        
        container.innerHTML = html;
      }

      shareCurrent() {
        const hoje = new Date().getDay();
        const eventosHoje = this.dados.cultos.filter(e => e.dia === hoje && this.eventoValido(e));
        if (eventosHoje.length > 0) {
          const e = eventosHoje[0];
          navigator.clipboard?.writeText(`*${e.titulo}*\nüìç ${e.local}\n‚è∞ ${e.horario}`)
            .then(() => this.toast('Evento copiado!'));
        }
      }

      irParaHoje() {
        document.getElementById('daily-view').scrollIntoView({ behavior: 'smooth' });
        this.toast('Rolando para hoje');
      }

      configurarAtalhos() {
        document.addEventListener('keydown', (e) => {
          if (e.key === '/') {
            e.preventDefault();
            document.getElementById('search').focus();
          }
          if (e.key === 'Escape') {
            document.getElementById('search').value = '';
            this.renderizar();
          }
        });
      }

      toast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
      }
    }

    const agenda = new AgendaCCB();
  </script>
</body>
</html>
