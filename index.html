<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Agenda CCB ‚Äî Amambai</title>
  
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f172a">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="color-scheme" content="dark light" />
  
  <style>
    :root{
      --bg:#ffffff; --card:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e2e8f0;
      --accent:#0f172a; --accent2:#0ea5e9; --ok:#16a34a;
      --shadow: 0 10px 22px rgba(2,6,23,.06);
      --shadow2: 0 22px 54px rgba(2,6,23,.10);
      --r:18px;
    }
    [data-theme="dark"]{
      --bg:#0b1220; --card:#0b152a; --ink:#e5e7eb; --muted:#94a3b8; --line:#1f2a44;
      --accent:#e5e7eb; --accent2:#38bdf8; --ok:#22c55e;
      --shadow: 0 14px 28px rgba(0,0,0,.28);
      --shadow2: 0 22px 54px rgba(0,0,0,.34);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 15% -10%, rgba(56,189,248,0.14), rgba(0,0,0,0) 55%),
        radial-gradient(900px 600px at 110% 0%, rgba(148,163,184,0.10), rgba(0,0,0,0) 50%),
        radial-gradient(900px 650px at 50% 120%, rgba(56,189,248,0.08), rgba(0,0,0,0) 55%),
        linear-gradient(135deg, #0b1220 0%, #0f172a 55%, #0b1220 100%);
      background-attachment: fixed;
      color: var(--ink);
    }
    .wrap{max-width:1040px;margin:0 auto;padding:16px 14px 90px}
    
    /* Header principal */
    .topo{
      width: 100%;
      max-width: 1040px;
      margin: 0 auto 12px auto;
      padding: 14px 14px 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.22);
      background: rgba(15,23,42,0.55);
      backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      gap:12px;
    }
    [data-theme="light"] .topo{
      background: rgba(255,255,255,0.78);
      border:1px solid var(--line);
    }
    
    .logoMark{
      width: 68px; height: 44px;
      border-radius: 12px;
      border: 1px solid rgba(56,189,248,0.25);
      background: #fff;
      display:grid;
      place-items:center;
      overflow:hidden;
      box-shadow: 0 10px 22px rgba(0,0,0,0.12);
    }
    .logoMark svg{width:60px;height:34px}
    .titulo h1{margin:0;font-size:18px;font-weight:950;color:var(--accent);letter-spacing:.2px}
    .subtitulo{margin:6px 0 0;font-size:13px;color:var(--muted);line-height:1.35}
    
    /* Barra superior */
    .toprow{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .titles p{margin:0;font-size:12px;line-height:1.35;color:var(--muted)}
    .actions{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    .btn{
      appearance:none;border:1px solid var(--line);
      background: rgba(255,255,255,.78);
      color: var(--accent);
      font-weight:950;font-size:12px;padding:9px 12px;border-radius:12px;cursor:pointer;
    }
    [data-theme="dark"] .btn{background: rgba(11,18,32,.70);}
    .btn.primary{border-color: rgba(56,189,248,.50);}
    .btn.danger{border-color: rgba(239,68,68,.50); color: #ef4444;}
    .btn.success{border-color: rgba(34,197,94,.50); color: #22c55e;}
    
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:7px 10px;
      font-size:12px;color:var(--muted);
      display:flex;gap:8px;align-items:center;
      background:rgba(255,255,255,.62)
    }
    [data-theme="dark"] .pill{background:rgba(11,18,32,.62)}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--accent2);box-shadow:0 0 0 4px rgba(56,189,248,.14);}
    
    /* Banner */
    .banner{
      margin-top:12px;border:1px solid rgba(56,189,248,.40);
      border-radius: var(--r);background: rgba(56,189,248,.10);
      padding:12px 14px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    }
    .banner .big{font-weight:950;font-size:13px}
    .banner .small{font-size:12px;color:var(--muted);line-height:1.35}
    .banner .right{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pchip{
      font-size:12px;font-weight:950;padding:7px 10px;border-radius:999px;
      border:1px solid rgba(56,189,248,.24);
      background: rgba(56,189,248,.12);color: var(--accent);white-space:nowrap;
      text-decoration:none;
    }
    .pchip.ok{border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.14);}
    .pchip.dim{border-color: rgba(148,163,184,.22); background: rgba(148,163,184,.12); opacity:.9;}
    
    /* Navega√ß√£o */
    .navCities{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .cityBtn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.72);
      padding:10px 12px;
      border-radius:14px;
      font-weight:950;
      font-size:13px;
      color:var(--accent);
      text-decoration:none;
      display:inline-flex;
      gap:10px;
      align-items:center;
    }
    [data-theme="dark"] .cityBtn{background: rgba(11,18,32,.70);}
    .cityBtn[aria-current="page"]{
      border-color: rgba(56,189,248,.60);
      box-shadow: 0 12px 28px rgba(56,189,248,.12);
    }
    .cityDot{
      width:10px;height:10px;border-radius:999px;background:var(--accent2);
      box-shadow:0 0 0 4px rgba(56,189,248,.10);
    }
    
    .nav{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .nav a{
      border:1px solid var(--line);
      background: rgba(255,255,255,.72);
      padding:10px 12px;border-radius:12px;
      font-weight:950;font-size:13px;color:var(--accent);text-decoration:none;
    }
    [data-theme="dark"] .nav a{background: rgba(11,18,32,.70);}
    .nav a[aria-current="true"]{border-color: rgba(56,189,248,.60);}
    
    /* Controles */
    .controls{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .search{
      flex:1 1 280px;
      display:flex;gap:10px;align-items:center;
      border:1px solid var(--line);border-radius:14px;
      padding:10px 12px;background: rgba(255,255,255,.72);
    }
    [data-theme="dark"] .search{background: rgba(11,18,32,.70);}
    .search input{border:0;outline:none;background:transparent;color:var(--ink);font-size:13px;width:100%}
    .helper{font-size:12px;color:var(--muted)}
    .switch{
      display:flex;gap:10px;align-items:center;border:1px solid var(--line);
      border-radius:14px;padding:10px 12px;background: rgba(255,255,255,.72);
      cursor:pointer;user-select:none;
    }
    [data-theme="dark"] .switch{background: rgba(11,18,32,.70);}
    .toggle{width:40px;height:22px;border-radius:999px;border:1px solid var(--line);background:rgba(148,163,184,.22);position:relative}
    .knob{width:18px;height:18px;border-radius:999px;background:var(--accent2);position:absolute;top:1px;left:1px;transition:left .15s ease}
    .switch.on .knob{left:19px}
    .switch span{font-weight:950;font-size:12px;color:var(--accent);}
    
    /* Bot√£o admin */
    .admin-btn{
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white !important;
      border: none !important;
    }
    
    /* Cards de dia */
    .section{margin-top:18px}
    .section h3{margin:0 0 10px;font-size:14px;font-weight:950;color:var(--accent)}
    
    .daycard{
      border:1px solid rgba(148,163,184,0.22);
      border-radius: var(--r);
      background: rgba(15,23,42,0.42);
      box-shadow: var(--shadow);
      overflow:hidden;margin:12px 0;
    }
    [data-theme="light"] .daycard{background: var(--card); border:1px solid var(--line)}
    .daycard.today{
      border-color: rgba(56,189,248,.78);
      box-shadow: 0 18px 46px rgba(56,189,248,.14);
    }
    .dayhead{
      padding:12px 14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      border-bottom:1px solid var(--line);
    }
    .dayname{font-weight:950;font-size:14px;color:var(--accent);}
    .badge{
      font-size:11px;color:var(--muted);border:1px solid var(--line);padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.62);
    }
    [data-theme="dark"] .badge{background:rgba(11,18,32,.62);}
    .badge.today{border-color: rgba(56,189,248,.55); color: var(--accent); background: rgba(56,189,248,.14);}
    
    /* Itens de evento */
    .items{padding:10px 14px 14px;display:flex;flex-direction:column;gap:10px}
    .item{
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 14px;
      background: rgba(2,6,23,0.18);
      padding:10px 12px;
    }
    [data-theme="light"] .item{background: rgba(248,250,252,.55); border:1px solid var(--line)}
    .item.next{border-color: rgba(56,189,248,.78); box-shadow: 0 14px 28px rgba(56,189,248,.12);}
    .item.past{opacity:.68}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-start;justify-content:space-between}
    .title{font-weight:950;font-size:13px;line-height:1.25}
    .place{margin-top:5px;color:var(--muted);font-size:12px;line-height:1.35}
    .meta{margin-top:8px;font-size:12px}
    .link{color:var(--accent2);font-weight:950;text-decoration:none}
    .link:hover{text-decoration:underline}
    .time{
      font-weight:950;font-size:12px;color: var(--accent);
      padding:7px 10px;border-radius:999px;border:1px solid rgba(56,189,248,.24);
      background: rgba(56,189,248,.12);white-space:nowrap;
    }
    .tag{
      display:inline-block;font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);
      background: rgba(255,255,255,.64);color: var(--muted);margin-left:6px;
    }
    [data-theme="dark"] .tag{background: rgba(11,18,32,.62);}
    
    /* Tabela de festas */
    .tablecard{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: var(--card);
      box-shadow: var(--shadow);
      overflow:hidden;
      margin-bottom: 20px;
    }
    [data-theme="dark"] .tablecard{background: rgba(15,23,42,0.42); border:1px solid rgba(148,163,184,0.22)}
    .tablehead{
      padding:14px;
      border-bottom:1px solid var(--line);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .tablehead .t{font-weight:950;font-size:14px;color:var(--accent);}
    .tablehead .s{margin-top:6px;font-size:12px;color:var(--muted);line-height:1.35}
    .tablewrap{overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:12px}
    th,td{padding:10px 12px;border-bottom:1px solid var(--line);vertical-align:middle}
    th{text-align:left;color:var(--muted);background:rgba(15,23,42,.75);}
    [data-theme="light"] th{background:rgba(248,250,252,.75);}
    tr:last-child td{border-bottom:0}
    .emph{font-weight:950}
    
    /* A√ß√µes da tabela */
    .action-btn{
      background: none;
      border: 1px solid var(--line);
      border-radius: 6px;
      padding: 4px 8px;
      margin: 0 2px;
      cursor: pointer;
      color: var(--ink);
      font-size: 11px;
    }
    .action-btn.edit:hover{background: var(--accent2); color: white;}
    .action-btn.delete:hover{background: #ef4444; color: white;}
    
    /* Modal */
    .modal{
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 20px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal h3{margin-bottom: 20px; color: var(--accent);}
    .modal input, .modal select, .modal textarea{
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: rgba(255,255,255,.1);
      color: var(--ink);
    }
    .modal-actions{
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    /* Toast */
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background: rgba(2,6,23,.92);color:#fff;
      padding:10px 12px;border-radius:12px;display:none;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
      font-size:12px;max-width:92vw;text-align:center;z-index:50;
    }
    [data-theme="dark"] .toast{background: rgba(229,231,235,.92); color:#0b1220;}
    
    /* FAB */
    .fabToday{
      position: fixed;
      right: 16px;
      bottom: 18px;
      z-index: 60;
      border: 1px solid rgba(56,189,248,.55);
      background: rgba(56,189,248,.16);
      color: var(--accent);
      font-weight: 950;
      font-size: 12px;
      padding: 10px 12px;
      border-radius: 999px;
      cursor: pointer;
      box-shadow: 0 14px 28px rgba(56,189,248,.14);
      backdrop-filter: blur(10px);
    }
    
    /* Impress√£o */
    @media print{
      body{background:#fff !important;color:#000 !important}
      .actions,.nav,.controls,.banner,.navCities{display:none !important}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- Header -->
    <header class="topo" role="banner">
      <div class="logoMark" aria-label="Logo CCB">
        <svg viewBox="0 0 240 140" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="CCB">
          <rect x="0" y="0" width="240" height="140" rx="18" fill="#ffffff"/>
          <path d="M120 18c27 0 50 17 58 40-9-6-20-10-33-10-18 0-34 8-44 20-10-12-26-20-44-20-13 0-24 4-33 10 8-23 31-40 58-40z" fill="#0f172a" opacity="0.92"/>
          <path d="M47 78c10-10 24-16 40-16 14 0 26 5 35 13 9-8 21-13 35-13 16 0 30 6 40 16-14 26-39 44-75 44S61 104 47 78z" fill="#0ea5e9" opacity="0.92"/>
          <text x="120" y="96" text-anchor="middle" font-family="Arial, Helvetica, sans-serif" font-size="34" font-weight="900" fill="#0f172a">CCB</text>
        </svg>
      </div>
      <div class="titulo">
        <h1>Agenda CCB ‚Äî Amambai</h1>
        <p class="subtitulo">Cultos, Reuni√µes e Festas Espirituais</p>
      </div>
    </header>

    <!-- Barra superior -->
    <div class="header">
      <div class="toprow">
        <div class="titles">
          <p><strong>Amambai ‚Äî MS</strong></p>
        </div>

        <div class="actions">
          <div class="pill"><span class="dot"></span><span id="modeTxt">Modo escuro</span></div>
          <button class="btn" type="button" onclick="toggleTheme()">üåì Tema</button>
          <button class="btn admin-btn" type="button" onclick="mostrarModalFesta()">‚ûï Adicionar Festa</button>
        </div>
      </div>

      <!-- Banner hoje -->
      <div class="banner" id="banner">
        <div>
          <div class="big" id="bannerBig">HOJE</div>
          <div class="small" id="bannerSmall">Carregando‚Ä¶</div>
        </div>
        <div class="right">
          <span class="pchip dim" id="clockChip">--:--</span>
          <span class="pchip dim" id="weekChip">Semana: ‚Äî</span>
          <span class="pchip ok" id="countChip">Falta: ‚Äî</span>
        </div>
      </div>

      <!-- Cidades -->
      <div class="navCities" aria-label="Cidades">
        <a class="cityBtn" href="#" aria-current="page"><span class="cityDot"></span>Amambai</a>
        <a class="cityBtn" href="#"><span class="cityDot"></span>Coronel Sapucaia</a>
        <a class="cityBtn" href="#"><span class="cityDot"></span>Aral Moreira</a>
      </div>

      <!-- Navega√ß√£o -->
      <nav class="nav" aria-label="Se√ß√µes">
        <a href="#cultos" aria-current="true">Cultos e Reuni√µes</a>
        <a href="#festas">Festas Espirituais</a>
      </nav>

      <!-- Controles -->
      <div class="controls">
        <div class="search">
          <input id="q" type="search" placeholder="Buscar: recitativos, jovens, vila gl√≥ria, 19:30..." oninput="aplicarFiltros()" />
        </div>
        <div class="switch" id="onlyTodaySwitch" onclick="toggleOnlyToday()">
          <div class="toggle"><div class="knob"></div></div>
          <span>Mostrar somente hoje</span>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o Cultos -->
    <div class="section" id="cultos">
      <h3>Cultos e Reuni√µes</h3>

      <!-- Segunda-feira -->
      <article class="daycard filterable" data-day="1" id="dia-1">
        <header class="dayhead">
          <div class="dayname">Segunda-Feira</div>
          <span class="badge" id="badge-1">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="19:30" data-rule="all" data-place="Vila Limeira" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos</div>
                <div class="place">Vila Limeira</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Ter√ßa-feira -->
      <article class="daycard filterable" data-day="2" id="dia-2">
        <header class="dayhead">
          <div class="dayname">Ter√ßa-Feira</div>
          <span class="badge" id="badge-2">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="19:30" data-rule="all" data-place="Vila Gl√≥ria" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Vila Gl√≥ria</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Quarta-feira -->
      <article class="daycard filterable" data-day="3" id="dia-3">
        <header class="dayhead">
          <div class="dayname">Quarta-Feira</div>
          <span class="badge" id="badge-3">Agenda</span>
        </header>
        <div class="items">
          <div class="item event" data-time="19:30" data-rule="all" data-place="Central Amambai" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Central Amambai</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Quinta-feira -->
      <article class="daycard filterable" data-day="4" id="dia-4">
        <header class="dayhead">
          <div class="dayname">Quinta-Feira</div>
          <span class="badge" id="badge-4">Agenda</span>
        </header>
        <div class="items">
          <!-- Todas as semanas -->
          <div class="item event" data-time="19:30" data-rule="all" data-place="Vila Limeira" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Vila Limeira</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <!-- 2¬™ quinta do m√™s -->
          <div class="item event" data-time="19:30" data-rule="nth:2" data-place="Vila Limeira" data-title="Culto com Ensaio">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Ensaio <span class="tag">2¬™ quinta do m√™s</span></div>
                <div class="place">Vila Limeira</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="19:30" data-rule="all" data-place="Aldeia Amambai ‚Äî Sert√£ozinho" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Aldeia Amambai ‚Äî Sert√£ozinho</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <!-- 3¬™ quinta do m√™s -->
          <div class="item event" data-time="19:30" data-rule="nth:3" data-place="Aldeia Amambai ‚Äî Sert√£ozinho" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos <span class="tag">3¬™ quinta do m√™s</span></div>
                <div class="place">Aldeia Amambai ‚Äî Sert√£ozinho</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Sexta-feira -->
      <article class="daycard filterable" data-day="5" id="dia-5">
        <header class="dayhead">
          <div class="dayname">Sexta-Feira</div>
          <span class="badge" id="badge-5">Agenda</span>
        </header>
        <div class="items">
          <!-- 1¬™ sexta do m√™s -->
          <div class="item event" data-time="19:30" data-rule="nth:1" data-place="Central Amambai" data-title="Ensaio Local">
            <div class="row">
              <div class="main">
                <div class="title">Ensaio Local <span class="tag">1¬™ sexta do m√™s</span></div>
                <div class="place">Central Amambai</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <!-- 3¬™ sexta do m√™s -->
          <div class="item event" data-time="19:30" data-rule="nth:3" data-place="Vila Cristina" data-title="Ensaio Local">
            <div class="row">
              <div class="main">
                <div class="title">Ensaio Local <span class="tag">3¬™ sexta do m√™s</span></div>
                <div class="place">Vila Cristina</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>

          <!-- 4¬™ sexta do m√™s -->
          <div class="item event" data-time="19:30" data-rule="nth:4" data-place="Vila Gl√≥ria" data-title="Ensaio Local">
            <div class="row">
              <div class="main">
                <div class="title">Ensaio Local <span class="tag">4¬™ sexta do m√™s</span></div>
                <div class="place">Vila Gl√≥ria</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- S√°bado -->
      <article class="daycard filterable" data-day="6" id="dia-6">
        <header class="dayhead">
          <div class="dayname">S√°bado</div>
          <span class="badge" id="badge-6">Agenda</span>
        </header>
        <div class="items">
          <!-- Todas as semanas -->
          <div class="item event" data-time="09:00" data-rule="all" data-place="Pres√≠dio de Amambai" data-title="Reuni√£o de Evangeliza√ß√£o">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Evangeliza√ß√£o</div>
                <div class="place">Pres√≠dio de Amambai</div>
              </div>
              <div class="time">09:00</div>
            </div>
          </div>

          <!-- 2¬™ e 4¬™ s√°bado -->
          <div class="item event" data-time="15:00" data-rule="nth:2,4" data-place="Lar do Idoso" data-title="Reuni√£o de Evangeliza√ß√£o">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Evangeliza√ß√£o <span class="tag">2¬∫ e 4¬∫ s√°bado</span></div>
                <div class="place">Lar do Idoso</div>
              </div>
              <div class="time">15:00</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="16:00" data-rule="all" data-place="Aldeia Lim√£o Verde" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Aldeia Lim√£o Verde</div>
              </div>
              <div class="time">16:00</div>
            </div>
          </div>

          <!-- 2¬™ s√°bado -->
          <div class="item event" data-time="18:30" data-rule="nth:2" data-place="Aldeia Amambai ‚Äî Invernada I" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos <span class="tag">2¬∫ s√°bado</span></div>
                <div class="place">Aldeia Amambai ‚Äî Invernada I</div>
              </div>
              <div class="time">18:30</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="19:30" data-rule="all" data-place="Central Amambai" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Central Amambai</div>
              </div>
              <div class="time">19:30</div>
            </div>
          </div>
        </div>
      </article>

      <!-- Domingo -->
      <article class="daycard filterable" data-day="0" id="dia-0">
        <header class="dayhead">
          <div class="dayname">Domingo</div>
          <span class="badge" id="badge-0">Agenda</span>
        </header>
        <div class="items">
          <!-- Todas as semanas -->
          <div class="item event" data-time="09:30" data-rule="all" data-place="Central Amambai" data-title="Reuni√£o de Jovens e Menores">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Jovens e Menores</div>
                <div class="place">Central Amambai</div>
              </div>
              <div class="time">09:30</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="09:30" data-rule="all" data-place="Vila Cristina" data-title="Reuni√£o de Jovens e Menores">
            <div class="row">
              <div class="main">
                <div class="title">Reuni√£o de Jovens e Menores</div>
                <div class="place">Vila Cristina</div>
              </div>
              <div class="time">09:30</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="15:00" data-rule="all" data-place="Aldeia Amambai Central" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Aldeia Amambai Central</div>
              </div>
              <div class="time">15:00</div>
            </div>
          </div>

          <!-- 1¬™ e 3¬™ domingo -->
          <div class="item event" data-time="15:00" data-rule="nth:1,3" data-place="Aldeia Amambai Central" data-title="Culto com Recitativo">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativo <span class="tag">1¬∫ e 3¬∫ domingo</span></div>
                <div class="place">Aldeia Amambai Central</div>
              </div>
              <div class="time">15:00</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="19:00" data-rule="all" data-place="Vila Gl√≥ria" data-title="Culto com Recitativos">
            <div class="row">
              <div class="main">
                <div class="title">Culto com Recitativos</div>
                <div class="place">Vila Gl√≥ria</div>
              </div>
              <div class="time">19:00</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="19:00" data-rule="all" data-place="Central Amambai" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Central Amambai</div>
              </div>
              <div class="time">19:00</div>
            </div>
          </div>

          <!-- Todas as semanas -->
          <div class="item event" data-time="19:00" data-rule="all" data-place="Vila Cristina" data-title="Culto Oficial">
            <div class="row">
              <div class="main">
                <div class="title">Culto Oficial</div>
                <div class="place">Vila Cristina</div>
              </div>
              <div class="time">19:00</div>
            </div>
          </div>
        </div>
      </article>
    </div>

    <!-- Se√ß√£o Festas Espirituais com CRUD -->
    <div class="section" id="festas">
      <h3>Festas Espirituais</h3>
      <div class="tablecard" id="festasCard">
        <div class="tablehead">
          <div>
            <div class="t">Festas da Regi√£o</div>
            <div class="s">Clique em editar para alterar ou excluir</div>
          </div>
          <button class="btn success" onclick="mostrarModalFesta()">‚ûï Nova Festa</button>
        </div>
        <div class="tablewrap">
          <table id="festasTable">
            <thead>
              <tr>
                <th>Data</th>
                <th>Hora</th>
                <th>Festa</th>
                <th>Congrega√ß√£o</th>
                <th>Irm√£o que atende</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="festas-tbody">
              <!-- As festas ser√£o inseridas aqui pelo JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>
  
  <!-- Bot√£o HOJE -->
  <button class="fabToday" onclick="irParaHoje()">HOJE</button>

  <!-- Modal para adicionar/editar festa -->
  <div id="festaModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3 id="modalTitulo">Nova Festa Espiritual</h3>
      
      <label>Tipo de Festa:</label>
      <select id="festaTipo">
        <option value="culto-mocidade">Culto para Mocidade</option>
        <option value="reuniao-mocidade">Reuni√£o para Mocidade</option>
        <option value="batismo">Batismo</option>
        <option value="santa-ceia">Santa Ceia</option>
        <option value="ensaio-regional">Ensaio Regional</option>
        <option value="outro">Outro</option>
      </select>
      
      <label>T√≠tulo (se outro):</label>
      <input type="text" id="festaTitulo" placeholder="Ex: Culto de Ora√ß√£o">
      
      <label>Data:</label>
      <input type="date" id="festaData">
      
      <label>Hora:</label>
      <input type="time" id="festaHora" value="19:30">
      
      <label>Congrega√ß√£o/Local:</label>
      <input type="text" id="festaLocal" placeholder="Ex: Central Amambai">
      
      <label>Irm√£o que atende:</label>
      <input type="text" id="festaIrmao" placeholder="Ex: Jos√© Oliveira">
      
      <div class="modal-actions">
        <button class="btn" onclick="fecharModal()">Cancelar</button>
        <button class="btn success" onclick="salvarFesta()">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    // ===== VARI√ÅVEIS GLOBAIS =====
    let festas = [];
    let festaEditandoId = null;
    const STORAGE_KEY = 'ccb_festas';
    
    // ===== FUN√á√ïES DE INICIALIZA√á√ÉO =====
    function carregarFestas() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        festas = JSON.parse(saved);
      } else {
        // Festas iniciais de exemplo
        festas = [
          { 
            id: '1', 
            tipo: 'culto-mocidade',
            titulo: 'Culto para Mocidade',
            data: '2026-02-26', 
            hora: '19:30', 
            local: 'Aldeia Amambai ‚Äî Sert√£ozinho', 
            irmao: 'Jo√£o Butarelli' 
          },
          { 
            id: '2', 
            tipo: 'santa-ceia',
            titulo: 'Santa Ceia',
            data: '2026-02-15', 
            hora: '19:30', 
            local: 'Central Amambai', 
            irmao: 'Mois√©s Crepaldi' 
          },
          { 
            id: '3', 
            tipo: 'batismo',
            titulo: 'Batismo',
            data: '2026-02-22', 
            hora: '15:00', 
            local: 'Vila Limeira', 
            irmao: 'Antonio Silva' 
          }
        ];
        salvarFestas();
      }
      renderizarFestas();
    }
    
    function salvarFestas() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(festas));
    }
    
    // ===== RENDERIZAR FESTAS NA TABELA =====
    function renderizarFestas() {
      const tbody = document.getElementById('festas-tbody');
      const hoje = new Date();
      hoje.setHours(0, 0, 0, 0);
      
      // Filtrar apenas festas futuras (ou iguais a hoje)
      const festasFuturas = festas.filter(f => {
        const dataFesta = new Date(f.data + 'T12:00:00');
        return dataFesta >= hoje;
      }).sort((a, b) => new Date(a.data) - new Date(b.data));
      
      if (festasFuturas.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 30px;">
              Nenhuma festa programada. Clique em "Nova Festa" para adicionar.
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = festasFuturas.map(f => {
        const dataObj = new Date(f.data + 'T12:00:00');
        const dataFormatada = dataObj.toLocaleDateString('pt-BR');
        
        // Definir √≠cone baseado no tipo
        let icone = '';
        switch(f.tipo) {
          case 'culto-mocidade': icone = 'üßë'; break;
          case 'reuniao-mocidade': icone = 'üë•'; break;
          case 'batismo': icone = 'üíß'; break;
          case 'santa-ceia': icone = 'üçá'; break;
          case 'ensaio-regional': icone = 'üéµ'; break;
          default: icone = '‚≠ê';
        }
        
        return `
          <tr data-id="${f.id}">
            <td class="emph">${dataFormatada}</td>
            <td>${f.hora}</td>
            <td>${icone} ${f.titulo}</td>
            <td>${f.local}</td>
            <td>Ir. ${f.irmao}</td>
            <td>
              <button class="action-btn edit" onclick="editarFesta('${f.id}')">‚úèÔ∏è Editar</button>
              <button class="action-btn delete" onclick="excluirFesta('${f.id}')">üóëÔ∏è Excluir</button>
            </td>
          </tr>
        `;
      }).join('');
    }
    
    // ===== FUN√á√ïES DO MODAL =====
    function mostrarModalFesta(festa = null) {
      const modal = document.getElementById('festaModal');
      const modalTitulo = document.getElementById('modalTitulo');
      
      if (festa) {
        // Modo edi√ß√£o
        modalTitulo.textContent = 'Editar Festa';
        document.getElementById('festaTipo').value = festa.tipo || 'outro';
        document.getElementById('festaTitulo').value = festa.titulo || '';
        document.getElementById('festaData').value = festa.data || '';
        document.getElementById('festaHora').value = festa.hora || '19:30';
        document.getElementById('festaLocal').value = festa.local || '';
        document.getElementById('festaIrmao').value = festa.irmao || '';
        festaEditandoId = festa.id;
      } else {
        // Modo novo
        modalTitulo.textContent = 'Nova Festa Espiritual';
        document.getElementById('festaTipo').value = 'culto-mocidade';
        document.getElementById('festaTitulo').value = '';
        
        // Data padr√£o: hoje + 7 dias
        const hoje = new Date();
        hoje.setDate(hoje.getDate() + 7);
        const ano = hoje.getFullYear();
        const mes = String(hoje.getMonth() + 1).padStart(2, '0');
        const dia = String(hoje.getDate()).padStart(2, '0');
        document.getElementById('festaData').value = `${ano}-${mes}-${dia}`;
        
        document.getElementById('festaHora').value = '19:30';
        document.getElementById('festaLocal').value = '';
        document.getElementById('festaIrmao').value = '';
        festaEditandoId = null;
      }
      
      modal.style.display = 'flex';
    }
    
    function fecharModal() {
      document.getElementById('festaModal').style.display = 'none';
    }
    
    function salvarFesta() {
      const tipo = document.getElementById('festaTipo').value;
      let titulo = document.getElementById('festaTitulo').value;
      const data = document.getElementById('festaData').value;
      const hora = document.getElementById('festaHora').value;
      const local = document.getElementById('festaLocal').value;
      const irmao = document.getElementById('festaIrmao').value;
      
      // Valida√ß√µes
      if (!data || !hora || !local || !irmao) {
        alert('Preencha todos os campos obrigat√≥rios!');
        return;
      }
      
      // Se for "outro", usa o t√≠tulo personalizado, sen√£o usa o t√≠tulo do tipo
      if (tipo === 'outro') {
        if (!titulo) {
          alert('Digite o t√≠tulo da festa!');
          return;
        }
      } else {
        // Mapear tipo para t√≠tulo
        const titulos = {
          'culto-mocidade': 'Culto para Mocidade',
          'reuniao-mocidade': 'Reuni√£o para Mocidade',
          'batismo': 'Batismo',
          'santa-ceia': 'Santa Ceia',
          'ensaio-regional': 'Ensaio Regional'
        };
        titulo = titulos[tipo];
      }
      
      const festa = {
        id: festaEditandoId || Date.now().toString(),
        tipo,
        titulo,
        data,
        hora,
        local,
        irmao
      };
      
      if (festaEditandoId) {
        // Atualizar existente
        const index = festas.findIndex(f => f.id === festaEditandoId);
        if (index !== -1) festas[index] = festa;
        mostrarToast('Festa atualizada com sucesso!');
      } else {
        // Adicionar nova
        festas.push(festa);
        mostrarToast('Festa adicionada com sucesso!');
      }
      
      salvarFestas();
      renderizarFestas();
      fecharModal();
      aplicarFiltros(); // Atualizar busca se necess√°rio
    }
    
    function editarFesta(id) {
      const festa = festas.find(f => f.id === id);
      if (festa) mostrarModalFesta(festa);
    }
    
    function excluirFesta(id) {
      if (confirm('Tem certeza que deseja excluir esta festa?')) {
        festas = festas.filter(f => f.id !== id);
        salvarFestas();
        renderizarFestas();
        mostrarToast('Festa exclu√≠da com sucesso!');
        aplicarFiltros();
      }
    }
    
    // ===== FUN√á√ïES DE TEMA =====
    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('ccb_theme', next);
      document.getElementById('modeTxt').textContent = next === 'dark' ? 'Modo escuro' : 'Modo claro';
    }
    
    function initTheme() {
      const saved = localStorage.getItem('ccb_theme') || 'dark';
      document.documentElement.setAttribute('data-theme', saved);
      document.getElementById('modeTxt').textContent = saved === 'dark' ? 'Modo escuro' : 'Modo claro';
    }
    
    // ===== FUN√á√ïES DE DATA E HORA =====
    function formatarData() {
      const agora = new Date();
      const dia = String(agora.getDate()).padStart(2, '0');
      const mes = String(agora.getMonth() + 1).padStart(2, '0');
      const ano = agora.getFullYear();
      return `${dia}/${mes}/${ano}`;
    }
    
    function getSemanaDoMes() {
      const hoje = new Date();
      const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
      const primeiroDiaSemana = primeiroDia.getDay();
      return Math.ceil((hoje.getDate() + primeiroDiaSemana) / 7);
    }
    
    function getNomeDia(dia) {
      const dias = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
      return dias[dia];
    }
    
    // ===== FUN√á√ïES DE FILTRO =====
    let onlyToday = false;
    
    function toggleOnlyToday() {
      onlyToday = !onlyToday;
      const sw = document.getElementById('onlyTodaySwitch');
      if (onlyToday) sw.classList.add('on');
      else sw.classList.remove('on');
      localStorage.setItem('ccb_only_today', onlyToday ? '1' : '0');
      aplicarFiltros();
    }
    
    function aplicarFiltros() {
      const termo = document.getElementById('q').value.toLowerCase();
      const hoje = new Date().getDay();
      
      // Filtrar cards de dia
      document.querySelectorAll('.daycard').forEach(card => {
        const diaCard = parseInt(card.dataset.day);
        const textoCard = card.innerText.toLowerCase();
        
        let mostrar = true;
        if (termo && !textoCard.includes(termo)) mostrar = false;
        if (onlyToday && diaCard !== hoje) mostrar = false;
        
        card.style.display = mostrar ? '' : 'none';
      });
      
      // Filtrar eventos dentro dos cards
      document.querySelectorAll('.event').forEach(evento => {
        const rule = evento.dataset.rule || 'all';
        if (rule !== 'all') {
          const semana = getSemanaDoMes();
          const semanas = rule.replace('nth:', '').split(',').map(Number);
          if (!semanas.includes(semana)) {
            evento.style.display = 'none';
          } else {
            evento.style.display = '';
          }
        }
      });
      
      // Atualizar banner
      atualizarBanner();
    }
    
    // ===== ATUALIZAR BANNER =====
    function atualizarBanner() {
      const agora = new Date();
      const dia = agora.getDay();
      const horaAtual = agora.getHours() * 60 + agora.getMinutes();
      
      document.getElementById('clockChip').textContent = 
        String(agora.getHours()).padStart(2, '0') + ':' + String(agora.getMinutes()).padStart(2, '0');
      
      document.getElementById('weekChip').textContent = 
        `Semana: ${getSemanaDoMes()}¬™ (${getNomeDia(dia)})`;
      
      document.getElementById('bannerBig').textContent = 
        `HOJE ‚Äî ${getNomeDia(dia)} (${formatarData()})`;
      
      // Buscar eventos de hoje
      const eventosHoje = Array.from(document.querySelectorAll(`.daycard[data-day="${dia}"] .event`))
        .filter(e => e.style.display !== 'none');
      
      if (eventosHoje.length === 0) {
        document.getElementById('bannerSmall').textContent = 'Nenhum evento hoje';
        document.getElementById('countChip').textContent = 'Falta: ‚Äî';
        return;
      }
      
      // Listar eventos
      const lista = eventosHoje.map(e => {
        const titulo = e.querySelector('.title')?.innerText || '';
        const hora = e.querySelector('.time')?.innerText || '';
        return `${hora} - ${titulo}`;
      }).join('<br>');
      
      document.getElementById('bannerSmall').innerHTML = `Hoje:<br>${lista}`;
      
      // Calcular pr√≥ximo evento
      let proximo = null;
      let menorDiferenca = Infinity;
      
      eventosHoje.forEach(e => {
        const horaTexto = e.querySelector('.time')?.innerText || '';
        const [h, m] = horaTexto.split(':').map(Number);
        const minutosEvento = h * 60 + m;
        
        if (minutosEvento > horaAtual) {
          const diff = minutosEvento - horaAtual;
          if (diff < menorDiferenca) {
            menorDiferenca = diff;
            proximo = e;
          }
        }
      });
      
      if (proximo) {
        const horas = Math.floor(menorDiferenca / 60);
        const minutos = menorDiferenca % 60;
        const texto = horas > 0 ? `${horas}h ${minutos}min` : `${minutos}min`;
        document.getElementById('countChip').textContent = `Falta: ${texto}`;
      } else {
        document.getElementById('countChip').textContent = 'Falta: 0min';
      }
    }
    
    // ===== FUN√á√ïES DE NAVEGA√á√ÉO =====
    function irParaHoje() {
      const hoje = new Date().getDay();
      const elemento = document.getElementById(`dia-${hoje}`);
      if (elemento) {
        elemento.scrollIntoView({ behavior: 'smooth' });
        mostrarToast('Rolando para o dia de hoje');
      }
    }
    
    // ===== TOAST =====
    function mostrarToast(mensagem) {
      const toast = document.getElementById('toast');
      toast.textContent = mensagem;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 3000);
    }
    
    // ===== INICIALIZA√á√ÉO =====
    function init() {
      initTheme();
      
      // Carregar prefer√™ncia "only today"
      const savedOnlyToday = localStorage.getItem('ccb_only_today') === '1';
      onlyToday = savedOnlyToday;
      const sw = document.getElementById('onlyTodaySwitch');
      if (onlyToday) sw.classList.add('on');
      
      // Carregar festas
      carregarFestas();
      
      // Aplicar filtros iniciais
      aplicarFiltros();
      
      // Atualizar a cada minuto
      setInterval(atualizarBanner, 60000);
    }
    
    init();
  </script>
</body>
</html>
