<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Agenda CCB — Coronel Sapucaia</title>
<meta name="theme-color" content="#0f172a" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22512%22%20height%3D%22512%22%3E%0A%3Cdefs%3E%3ClinearGradient%20id%3D%22g%22%20x1%3D%220%22%20y1%3D%220%22%20x2%3D%221%22%20y2%3D%221%22%3E%0A%3Cstop%20offset%3D%220%22%20stop-color%3D%22%230f172a%22%2F%3E%3Cstop%20offset%3D%221%22%20stop-color%3D%22%2338bdf8%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%0A%3Crect%20width%3D%22512%22%20height%3D%22512%22%20rx%3D%22120%22%20fill%3D%22url%28%23g%29%22%2F%3E%0A%3Ctext%20x%3D%2250%25%22%20y%3D%2256%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Arial%2C%20sans-serif%22%20font-size%3D%22170%22%20font-weight%3D%22900%22%20fill%3D%22%23fff%22%3ECCB%3C%2Ftext%3E%0A%3C%2Fsvg%3E">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22512%22%20height%3D%22512%22%3E%0A%3Cdefs%3E%3ClinearGradient%20id%3D%22g%22%20x1%3D%220%22%20y1%3D%220%22%20x2%3D%221%22%20y2%3D%221%22%3E%0A%3Cstop%20offset%3D%220%22%20stop-color%3D%22%230f172a%22%2F%3E%3Cstop%20offset%3D%221%22%20stop-color%3D%22%2338bdf8%22%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%0A%3Crect%20width%3D%22512%22%20height%3D%22512%22%20rx%3D%22120%22%20fill%3D%22url%28%23g%29%22%2F%3E%0A%3Ctext%20x%3D%2250%25%22%20y%3D%2256%25%22%20text-anchor%3D%22middle%22%20font-family%3D%22Arial%2C%20sans-serif%22%20font-size%3D%22170%22%20font-weight%3D%22900%22%20fill%3D%22%23fff%22%3ECCB%3C%2Ftext%3E%0A%3C%2Fsvg%3E">
<link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%20%22Agenda%20CCB%20Amambai%22%2C%20%22short_name%22%3A%20%22CCB%20Amambai%22%2C%20%22start_url%22%3A%20%22.%22%2C%20%22scope%22%3A%20%22.%22%2C%20%22display%22%3A%20%22standalone%22%2C%20%22background_color%22%3A%20%22%230b1220%22%2C%20%22theme_color%22%3A%20%22%230f172a%22%2C%20%22icons%22%3A%20%5B%7B%22src%22%3A%20%22data%3Aimage%2Fsvg%2Bxml%2C%253Csvg%2520xmlns%253D%2522http%253A%252F%252Fwww.w3.org%252F2000%252Fsvg%2522%2520width%253D%2522512%2522%2520height%253D%2522512%2522%253E%250A%253Cdefs%253E%253ClinearGradient%2520id%253D%2522g%2522%2520x1%253D%25220%2522%2520y1%253D%25220%2522%2520x2%253D%25221%2522%2520y2%253D%25221%2522%253E%250A%253Cstop%2520offset%253D%25220%2522%2520stop-color%253D%2522%25230f172a%2522%252F%253E%253Cstop%2520offset%253D%25221%2522%2520stop-color%253D%2522%252338bdf8%2522%252F%253E%253C%252FlinearGradient%253E%253C%252Fdefs%253E%250A%253Crect%2520width%253D%2522512%2522%2520height%253D%2522512%2522%2520rx%253D%2522120%2522%2520fill%253D%2522url%2528%2523g%2529%2522%252F%253E%250A%253Ctext%2520x%253D%252250%2525%2522%2520y%253D%252256%2525%2522%2520text-anchor%253D%2522middle%2522%2520font-family%253D%2522Arial%252C%2520sans-serif%2522%2520font-size%253D%2522170%2522%2520font-weight%253D%2522900%2522%2520fill%253D%2522%2523fff%2522%253ECCB%253C%252Ftext%253E%250A%253C%252Fsvg%253E%22%2C%20%22sizes%22%3A%20%22512x512%22%2C%20%22type%22%3A%20%22image%2Fsvg%2Bxml%22%7D%5D%7D"/>

<style>
:root{
  --bg:#ffffff; --card:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e2e8f0;
  --accent:#0f172a; --accent2:#0ea5e9; --ok:#16a34a;
  --shadow: 0 10px 22px rgba(2,6,23,.06); --shadow2: 0 22px 54px rgba(2,6,23,.10); --r:18px;
}
[data-theme="dark"]{
  --bg:#0b1220; --card:#0b152a; --ink:#e5e7eb; --muted:#94a3b8; --line:#1f2a44;
  --accent:#e5e7eb; --accent2:#38bdf8; --ok:#22c55e;
  --shadow: 0 14px 28px rgba(0,0,0,.28); --shadow2: 0 22px 54px rgba(0,0,0,.34);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(56,189,248,.14), transparent 55%),
    radial-gradient(900px 600px at 110% 0%, rgba(148,163,184,.10), transparent 50%),
    var(--bg);
  color: var(--ink);
}
.wrap{max-width:1040px;margin:0 auto;padding:16px 14px 84px}
.header{
  border:1px solid var(--line);
  border-radius: calc(var(--r) + 10px);
  background: linear-gradient(180deg, rgba(248,250,252,.92), rgba(255,255,255,.86));
  box-shadow: var(--shadow2);
  padding: 14px;
}
[data-theme="dark"] .header{ background: linear-gradient(180deg, rgba(15,23,42,.95), rgba(11,18,32,.92)); }
.toprow{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.logo{width:46px;height:46px;border-radius:14px;display:grid;place-items:center;font-weight:900;letter-spacing:.6px;color:#fff;
  background: linear-gradient(135deg, rgba(15,23,42,.96), rgba(56,189,248,.86));}
.titles h1{margin:0;font-size:15px;font-weight:950;color:var(--accent)}
.titles p{margin:6px 0 0;font-size:12px;line-height:1.35;color:var(--muted)}
.actions{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
.btn{appearance:none;border:1px solid var(--line);background: rgba(255,255,255,.78);color: var(--accent);
  font-weight:950;font-size:12px;padding:9px 12px;border-radius:12px;cursor:pointer;}
[data-theme="dark"] .btn{background: rgba(11,18,32,.70);}
.btn.primary{border-color: rgba(56,189,248,.50);}
.pill{border:1px solid var(--line);border-radius:999px;padding:7px 10px;font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.62)}
[data-theme="dark"] .pill{background:rgba(11,18,32,.62)}
.dot{width:8px;height:8px;border-radius:999px;background:var(--accent2);box-shadow:0 0 0 4px rgba(56,189,248,.14);}

.banner{margin-top:12px;border:1px solid rgba(56,189,248,.40);border-radius: var(--r);background: rgba(56,189,248,.10);
  padding:12px 14px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;}
.banner .big{font-weight:950;font-size:13px}
.banner .small{font-size:12px;color:var(--muted);line-height:1.35}
.banner .right{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pchip{font-size:12px;font-weight:950;padding:7px 10px;border-radius:999px;border:1px solid rgba(56,189,248,.24);
  background: rgba(56,189,248,.12);color: var(--accent);white-space:nowrap;}
.pchip.ok{border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.14);}
.pchip.dim{border-color: rgba(148,163,184,.22); background: rgba(148,163,184,.12); opacity:.9;}

.nav{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.nav a{border:1px solid var(--line);background: rgba(255,255,255,.72);padding:10px 12px;border-radius:12px;
  font-weight:950;font-size:13px;color:var(--accent);text-decoration:none;}
[data-theme="dark"] .nav a{background: rgba(11,18,32,.70);}
.nav a[aria-current="true"]{border-color: rgba(56,189,248,.60);}

.controls{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.search{flex:1 1 280px;display:flex;gap:10px;align-items:center;border:1px solid var(--line);border-radius:14px;
  padding:10px 12px;background: rgba(255,255,255,.72);}
[data-theme="dark"] .search{background: rgba(11,18,32,.70);}
.search input{border:0;outline:none;background:transparent;color:var(--ink);font-size:13px;width:100%}
.helper{font-size:12px;color:var(--muted)}
.switch{display:flex;gap:10px;align-items:center;border:1px solid var(--line);border-radius:14px;
  padding:10px 12px;background: rgba(255,255,255,.72);cursor:pointer;user-select:none;}
[data-theme="dark"] .switch{background: rgba(11,18,32,.70);}
.toggle{width:40px;height:22px;border-radius:999px;border:1px solid var(--line);background:rgba(148,163,184,.22);position:relative}
.knob{width:18px;height:18px;border-radius:999px;background:var(--accent2);position:absolute;top:1px;left:1px;transition:left .15s ease}
.switch.on .knob{left:19px}
.switch span{font-weight:950;font-size:12px;color:var(--accent);}

.section{margin-top:18px}
.section h3{margin:0 0 10px;font-size:14px;font-weight:950;color:var(--accent)}

.daycard{border:1px solid var(--line);border-radius: var(--r);background: var(--card);box-shadow: var(--shadow);overflow:hidden;margin:12px 0;}
.daycard.today{border-color: rgba(56,189,248,.78); box-shadow: 0 18px 46px rgba(56,189,248,.14);}
.dayhead{padding:12px 14px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);}
.dayname{font-weight:950;font-size:14px;color:var(--accent);}
.badge{font-size:11px;color:var(--muted);border:1px solid var(--line);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.62);}
[data-theme="dark"] .badge{background:rgba(11,18,32,.62);}
.badge.today{border-color: rgba(56,189,248,.55); color: var(--accent); background: rgba(56,189,248,.14);}

.items{padding:10px 14px 14px;display:flex;flex-direction:column;gap:10px}
.item{border:1px solid var(--line);border-radius: 14px;background: rgba(248,250,252,.55);padding:10px 12px;}
[data-theme="dark"] .item{background: rgba(15,23,42,.55);}
.item.next{border-color: rgba(56,189,248,.78); box-shadow: 0 14px 28px rgba(56,189,248,.12);}
.item.past{opacity:.68}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-start;justify-content:space-between}
.title{font-weight:950;font-size:13px;line-height:1.25}
.place{margin-top:5px;color:var(--muted);font-size:12px;line-height:1.35}
.meta{margin-top:8px;font-size:12px}
.link{color:var(--accent2);font-weight:950;text-decoration:none}
.link:hover{text-decoration:underline}
.time{font-weight:950;font-size:12px;color: var(--accent);padding:7px 10px;border-radius:999px;border:1px solid rgba(56,189,248,.24);
  background: rgba(56,189,248,.12);white-space:nowrap;}
.tag{display:inline-block;font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);
  background: rgba(255,255,255,.64);color: var(--muted);margin-left:6px;}
[data-theme="dark"] .tag{background: rgba(11,18,32,.62);}

.tablecard{border:1px solid var(--line);border-radius: var(--r);background: var(--card);box-shadow: var(--shadow);overflow:hidden;}
.tablehead{padding:14px;border-bottom:1px solid var(--line);}
.tablehead .t{font-weight:950;font-size:14px;color:var(--accent);}
.tablehead .s{margin-top:6px;font-size:12px;color:var(--muted);line-height:1.35}
.tablewrap{overflow:auto}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{padding:10px 12px;border-bottom:1px solid var(--line);vertical-align:top}
th{text-align:left;color:var(--muted);background:rgba(15,23,42,.75);}
[data-theme="light"] th{background:rgba(248,250,252,.75);}
tr:last-child td{border-bottom:0}
.emph{font-weight:950}

.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background: rgba(2,6,23,.92);color:#fff;
  padding:10px 12px;border-radius:12px;display:none;box-shadow: 0 10px 22px rgba(0,0,0,.22);font-size:12px;max-width:92vw;text-align:center;z-index:50;}
[data-theme="dark"] .toast{background: rgba(229,231,235,.92); color:#0b1220;}

@media print{
  body{background:#fff}
  .actions,.nav,.controls,.banner{display:none !important}
  .wrap{max-width:100%;padding:0}
  .header{box-shadow:none;border:0;border-radius:0}
  .daycard,.tablecard{box-shadow:none}
}

/* CABEÇALHO COM LOGO CCB */
.topo {
    display:flex;
    align-items:center;
    justify-content:center;
    gap:15px;
    padding:15px;
    margin-bottom:20px;
}
.logo {
    height:55px;
}
.titulo {
    text-align:left;
}
.subtitulo {
    margin:0;
    font-size:14px;
    opacity:0.7;
}


/* FUNDO PROFISSIONAL */
body {
    font-family: Arial, Helvetica, sans-serif;
    background: linear-gradient(135deg, #0b1220 0%, #1e293b 50%, #0f172a 100%);
    background-attachment: fixed;
    color: #ffffff;
}

/* efeito cartão profissional */
.daycard {
    background: rgba(255,255,255,0.04);
    backdrop-filter: blur(8px);
    border-radius: 12px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.25);
}


/* ===== UPGRADE VISUAL (PROFISSIONAL, SEM EXAGERO) ===== */

/* Fundo com iluminação central + textura sutil (CSS puro) */
body{
  background:
    radial-gradient(1200px 700px at 15% -10%, rgba(56,189,248,0.14), rgba(0,0,0,0) 55%),
    radial-gradient(900px 600px at 110% 0%, rgba(148,163,184,0.10), rgba(0,0,0,0) 50%),
    radial-gradient(900px 650px at 50% 120%, rgba(56,189,248,0.08), rgba(0,0,0,0) 55%),
    linear-gradient(135deg, #0b1220 0%, #0f172a 55%, #0b1220 100%);
  background-attachment: fixed;
}

/* “Textura” discreta por repetição de gradiente (tipo papel) */
body::before{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0.06;
  background:
    repeating-linear-gradient(0deg, rgba(255,255,255,0.06) 0px, rgba(255,255,255,0.06) 1px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 6px),
    repeating-linear-gradient(90deg, rgba(255,255,255,0.04) 0px, rgba(255,255,255,0.04) 1px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 10px);
  mix-blend-mode: overlay;
}

/* Conteúdo com “cartão” principal mais institucional */
.header{
  border: 1px solid rgba(56,189,248,0.22);
  background: linear-gradient(180deg, rgba(15,23,42,0.92), rgba(11,18,32,0.86));
  box-shadow: 0 18px 46px rgba(0,0,0,0.34);
}

/* Cabeçalho com logo: mais “oficial” e alinhado */
.topo{
  width: 100%;
  max-width: 1040px;
  margin: 0 auto 12px auto;
  padding: 14px 14px 10px 14px;
  border-radius: 18px;
  border: 1px solid rgba(148,163,184,0.22);
  background: rgba(15,23,42,0.55);
  backdrop-filter: blur(10px);
}

/* Logo em “selo” */
.logo{
  height: 56px;
  width: 56px;
  object-fit: contain;
  padding: 8px;
  border-radius: 16px;
  border: 1px solid rgba(56,189,248,0.25);
  background: linear-gradient(135deg, rgba(15,23,42,0.92), rgba(56,189,248,0.14));
  box-shadow: 0 10px 22px rgba(0,0,0,0.22);
}

/* Tipografia mais institucional */
.titulo h1{
  margin: 0;
  font-size: 18px;
  letter-spacing: 0.2px;
}
.subtitulo{
  margin-top: 6px;
  font-size: 13px;
  opacity: 0.75;
}

/* Cartões: borda mais “limpa” */
.daycard{
  border: 1px solid rgba(148,163,184,0.22);
  background: rgba(15,23,42,0.42);
}
.item{
  border: 1px solid rgba(148,163,184,0.18);
  background: rgba(2,6,23,0.18);
}


/* CORREÇÃO MODO CLARO */
[data-theme="light"]{
  --bg-main:#f1f5f9;
  --card-bg:#ffffff;
  --text-main:#0f172a;
}

[data-theme="light"] body{
  background:#f1f5f9 !important;
  color:#0f172a !important;
}

[data-theme="light"] .header,
[data-theme="light"] .daycard,
[data-theme="light"] .item{
  background:#ffffff !important;
  color:#0f172a !important;
  border-color:rgba(15,23,42,0.15) !important;
}

[data-theme="light"] .btn{
  background:#e2e8f0 !important;
  color:#0f172a !important;
}


/* ABAS DE CIDADES */
.citytabs{display:none !important; /* oculto em páginas */
/*
  margin-top:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.ctab{
  appearance:none;
  border:1px solid var(--line);
  background: rgba(255,255,255,.72);
  padding:10px 12px;
  border-radius:12px;
  font-weight:950;
  font-size:13px;
  color:var(--accent);
  cursor:pointer;
}
[data-theme="dark"] .ctab{ background: rgba(11,18,32,.70); }
.ctab.active{
  border-color: rgba(56,189,248,.65);
  box-shadow: 0 12px 28px rgba(56,189,248,.10);
}


/* City tabs - visual de navegação */
.ctab{ position: relative; }
.ctab.active::after{
  content:"";
  position:absolute;
  left:12px; right:12px; bottom:6px;
  height:3px; border-radius:999px;
  background: rgba(56,189,248,.85);
}


/* Indicador de semana do mês */
.bannerSub{
  margin-top:6px;
  font-size: 13px;
  opacity: .85;
}

</style>
</head>

<body data-city="coronel_sapucaia">
<div class="wrap">
<header class="topo">
    <div style="background:white;padding:6px 14px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.35);display:inline-block;"><img src="logo-ccb.png" style="height:85px;width:auto;display:block;" class="logo" alt="Logo CCB"></div>
    <div class="titulo">
        <h1>Agenda CCB Coronel Sapucaia</h1>
        <p class="subtitulo">Agenda oficial de cultos e reuniões</p>
    </div>
</header>
<div class="cityNavPages" aria-label="Cidades">
  <a class="cityLink" href="index.html">Amambai</a>
  <a class="cityLink active" href="coronel-sapucaia.html">Coronel Sapucaia</a>
  <a class="cityLink" href="aral-moreira.html">Aral Moreira</a>
</div>


  <div class="header">
    <div class="toprow">
      <div class="logo">CCB</div>
      <div class="titles">
<p><strong>Amambai — MS</strong> • Agenda oficial com destaque do dia e do próximo culto.</p>
      </div>

      <div class="actions">
        <div class="pill"><span class="dot"></span><span id="modeTxt">Modo escuro</span></div>
        <button class="btn" type="button" onclick="printPage()">Imprimir</button>
        <button class="btn" type="button" onclick="toggleTheme()">Modo claro/escuro</button>
        <button class="btn primary" type="button" onclick="shareOrCopy()">Compartilhar</button>
      </div>
    </div>

    <div class="banner" id="banner">
      <div>
        <div class="big" id="bannerBig">HOJE</div>
        <div class="bannerSub" id="weekInfo"></div>
        <div class="small" id="bannerSmall">Carregando…</div>
      </div>
      <div class="right">
        <span class="pchip dim" id="clockChip">--:--</span>
        <span class="pchip ok" id="countChip">Falta: —</span>
        <a class="pchip" id="mapsChip" href="#" target="_blank" rel="noopener" style="text-decoration:none;">Abrir no Maps</a>
      </div>
    </div>

    
    <div class="citytabs" role="tablist" aria-label="Cidades">
      <button class="ctab active" role="tab" aria-selected="true" data-city="amambai" onclick="setCity('diamantina')">Amambai</button>
      <button class="ctab" role="tab" aria-selected="false" data-city="coronel_sapucaia" onclick="setCity('coronel_sapucaia')">Coronel Sapucaia</button>
      <button class="ctab" role="tab" aria-selected="false" data-city="aral_moreira" onclick="setCity('aral_moreira')">Aral Moreira</button>
    </div>

    <nav class="nav">
      <a href="#cultos" aria-current="true">Cultos e Reuniões</a>
      <a href="#festas">Festas espirituais</a>
    </nav>

    <div class="controls">
      <div class="search">
        <input id="q" type="search" placeholder="Buscar: recitativos, jovens, vila glória, 19:30..." oninput="applyAllFilters()" />
      </div>
      <div class="switch" id="onlyTodaySwitch" onclick="toggleOnlyToday()">
        <div class="toggle"><div class="knob"></div></div>
        <span>Mostrar somente o dia de hoje</span>
      </div>
      <div class="helper">Dica: se abrir pelo WhatsApp e algo falhar, toque “Abrir no navegador”.</div>
    </div>
  </div>

  <div class="section" id="cultos">
    <h3>Cultos e Reuniões</h3>
    
    </div>

    <!-- ===== OUTRAS CIDADES (AGENDA AINDA NÃO CADASTRADA) ===== -->
    <article class="daycard filterable" data-day="0" data-city="coronel_sapucaia" data-search="coronel sapucaia agenda">
      <header class="dayhead">
        <div class="dayname">Coronel Sapucaia</div>
        <div class="badges"><span class="badge">Agenda</span></div>
      </header>
      <div class="items">
        <div class="item">
          <div class="row">
            <div class="main">
              <div class="title">Agenda ainda não cadastrada</div>
              <div class="place">Quando você me mandar os dias/horários de Coronel Sapucaia, eu preencho aqui.</div>
            </div>
            <div class="time">—</div>
          </div>
        </div>
      </div>
    </article>

    <div class="section" id="festas">
    <h3>Festas espirituais</h3>
    </div>

<div class="toast" id="toast"></div>

<script>
(function(){
  var THEME_KEY = "ccb_amambai_theme";
  var ONLY_TODAY_KEY = "ccb_amambai_only_today";
  var CITY_KEY = "ccb_amambai_city";
  var currentCity = "coronel_sapucaia";

  function byId(id){ return document.getElementById(id); }
  function text(el){ return (el && (el.innerText || el.textContent)) ? (el.innerText || el.textContent) : ""; }
  function trim(s){ return (s||"").replace(/^\s+|\s+$/g,""); }

  function weekdayOrdinal(d){
    // 1º, 2º, 3º... ocorrência do dia da semana no mês (para a data atual)
    return Math.floor((d.getDate()-1)/7)+1;
  }
  function itemMatchesOrdinal(item, d){
    var ordAttr = item.getAttribute('data-ordinals');
    if(!ordAttr) return true; // semanal
    var ord = weekdayOrdinal(d);
    var parts = ordAttr.split(',').map(function(x){ return parseInt(x,10); });
    for(var i=0;i<parts.length;i++){
      if(parts[i] === ord) return true;
    }
    return false;
  }
  function pad2(n){ n=String(n); return (n.length<2)?("0"+n):n; }
  function minutesFromHHMM(hhmm){
    if(!hhmm) return null;
    var m = /^(\d{1,2}):(\d{2})$/.exec(hhmm);
    if(!m) return null;
    return parseInt(m[1],10)*60 + parseInt(m[2],10);
  }
  function toast(msg){
    var t = byId("toast");
    if(!t) return;
    t.textContent = msg;
    t.style.display = "block";
    if(window.__t){ clearTimeout(window.__t); }
    window.__t = setTimeout(function(){ t.style.display="none"; }, 2200);
  }
  function formatCountdown(mins){
    if(mins < 0) mins = 0;
    var h = Math.floor(mins/60);
    var m = mins % 60;
    if(h <= 0) return m + " min";
    return h + "h " + pad2(m) + "min";
  }

  var weekdayName = ["Domingo","Segunda-Feira","Terça-Feira","Quarta-Feira","Quinta-Feira","Sexta-Feira","Sábado"];

  window.toggleTheme = function(){ 
    var cur = document.documentElement.getAttribute("data-theme") || "dark";
    var next = (cur === "dark") ? "light" : "dark";
    document.documentElement.setAttribute("data-theme", next);
    try{ localStorage.setItem(THEME_KEY, next); }catch(e){}
    var mt = byId("modeTxt");
    if(mt) mt.textContent = (next === "dark") ? "Modo escuro" : "Modo claro";
    toast(next === "dark" ? "Modo escuro ativado" : "Modo claro ativado");
    applyAllFilters();
  };

  function initTheme(){
    var saved = null;
    try{ saved = localStorage.getItem(THEME_KEY); }
  function cityToHash(city){
  if(city==='amambai') return '#amambai';
  if(city==='coronel_sapucaia') return '#coronel-sapucaia';
  if(city==='aral_moreira') return '#aral-moreira';
  return '#amambai';
}
function hashToCity(){
  var h=(location.hash||'').toLowerCase();
  if(h==='#coronel-sapucaia') return 'coronel_sapucaia';
  if(h==='#aral-moreira') return 'aral_moreira';
  return 'amambai';
}

function getSavedCity(){
    var v=null;
    try{ v = localStorage.getItem(CITY_KEY); }catch(e){}
    return v || "amambai";
  }
  window.setCity = function(city){
    currentCity = city || "amambai";
    // update tab UI
    var tabs = document.querySelectorAll(".ctab");
    for(var i=0;i<tabs.length;i++){
      var t = tabs[i];
      var c = t.getAttribute("data-city");
      var on = (c === currentCity);
      if(on){ t.classList.add("active"); t.setAttribute("aria-selected","true"); }
      else { t.classList.remove("active"); t.setAttribute("aria-selected","false"); }
    }
    try{ localStorage.setItem(CITY_KEY, currentCity); }catch(e){}
    // atualizar URL para compartilhar cidade
    try{ history.replaceState(null,'', cityToHash(currentCity)); }catch(e){}
    // rolar para o topo como se fosse outra página
    try{ window.scrollTo(0,0); }catch(e){}
    applyAllFilters();
    updateHighlights();
    toast("Cidade: " + (document.querySelector('.ctab.active') ? document.querySelector('.ctab.active').innerText : "Selecionada"));
  };
catch(e){}
    if(!saved) saved = "dark";
    document.documentElement.setAttribute("data-theme", saved);
    var mt = byId("modeTxt");
    if(mt) mt.textContent = (saved === "dark") ? "Modo escuro" : "Modo claro";
  }

  window.printPage = function(){ try{ window.print(); }catch(e){ toast("Impressão não disponível aqui. Abra no Safari/Chrome."); } };

  window.shareOrCopy = function(){
    var msg = "Agenda CCB Coronel Sapucaia — compartilhamento.";
    try{
      if(navigator && navigator.share){ navigator.share({ title: document.title, text: msg }); return; }
    }catch(e){}
    try{
      if(navigator && navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(msg).then(function(){ toast("Texto copiado ✅"); })
        .catch(function(){ toast("Envie este link/arquivo pelo WhatsApp ✅"); });
      } else { toast("Envie este link/arquivo pelo WhatsApp ✅"); }
    }catch(e){ toast("Envie este link/arquivo pelo WhatsApp ✅"); }
  };

  function setOnlyToday(on){
    var sw = byId("onlyTodaySwitch");
    if(sw){ if(on) sw.classList.add("on"); else sw.classList.remove("on"); }
    try{ localStorage.setItem(ONLY_TODAY_KEY, on ? "1" : "0"); }catch(e){}
  }
  function getOnlyToday(){
    var v="0";
    try{ v = localStorage.getItem(ONLY_TODAY_KEY) || "0"; }catch(e){}
    return v === "1";
  }
  window.toggleOnlyToday = function(){ setOnlyToday(!getOnlyToday()); applyAllFilters(); };

  window.applyAllFilters = function(){
    var q = trim((byId("q") && byId("q").value) ? byId("q").value : "").toLowerCase();
    var onlyToday = getOnlyToday();
    var today = new Date().getDay();
    // filtro por cidade
    var city = currentCity || 'amambai';

    var cards = document.querySelectorAll(".daycard");
    for(var i=0;i<cards.length;i++){
      var card = cards[i];
      var day = parseInt(card.getAttribute("data-day"),10);
      var cardCity = card.getAttribute('data-city') || 'diamantina';
      var hay = (card.getAttribute("data-search") || text(card)).toLowerCase();
      var show = true;
      if(cardCity !== city) show = false;
      if(q && hay.indexOf(q) === -1) show = false;
      if(onlyToday && day !== today) show = false;
      card.style.display = show ? "" : "none";
      // Se estiver no modo "somente hoje", dentro do card do dia, esconda eventos que não são desta semana do mês
      if(show && onlyToday && day === today){
        var its = card.querySelectorAll(".item");
        var now = new Date();
        for(var k=0;k<its.length;k++){
          var it = its[k];
          it.style.display = itemMatchesOrdinal(it, now) ? "" : "none";
        }
      }
    }

    var city = currentCity || "amambai";
    var festaCards = document.querySelectorAll(".tablecard.filterable[id^='festasCard']");
    for(var fc=0; fc<festasCards.length; fc++){
      var ccity = festasCards[fc].getAttribute("data-city") || "amambai";
      festasCards[fc].style.display = (ccity===city) ? "" : "none";
    }

    var festaCard = byId("festasCard");
    var festaTrs = document.querySelectorAll("#festasTable tbody tr");
    var anyF=false;
    for(var k=0;k<festaTrs.length;k++){
      var tr=festaTrs[k];
      var fhay=(tr.getAttribute("data-search")||text(tr)).toLowerCase();
      var rcity = tr.getAttribute('data-city') || 'diamantina';
      var showF=(rcity === (currentCity||'diamantina'));
      if(q && fhay.indexOf(q)===-1) showF=false;
      tr.style.display = showF ? "" : "none";
      if(showF) anyF=true;
    }
    if(festaCard){ if(q && !anyF) festaCard.style.display="none"; else festaCard.style.display=""; }
  };

  
  function getWeekOfMonth(d){
    var date = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    var first = new Date(d.getFullYear(), d.getMonth(), 1);
    // week number: 1..5 based on day-of-month
    return Math.floor((date.getDate() - 1) / 7) + 1;
  }
  function ordinalPT(n, feminine){
    // feminine: true -> 1ª,2ª ; false -> 1º,2º
    var suf = feminine ? "ª" : "º";
    return String(n) + suf;
  }
  function weekdayPT(idx){
    return ["domingo","segunda-feira","terça-feira","quarta-feira","quinta-feira","sexta-feira","sábado"][idx];
  }
  function updateWeekInfo(){
    var el = byId("weekInfo");
    if(!el) return;
    var now = new Date();
    var wom = getWeekOfMonth(now); // 1..5
    var wd = now.getDay(); // 0..6
    // Para clareza: usamos feminino "semana"
    var line1 = "Semana atual do mês: " + ordinalPT(wom, true) + " semana";
    var line2 = "Hoje é " + weekdayPT(wd) + " — " + ordinalPT(wom, false) + " " + weekdayPT(wd) + " do mês";
    // Ajuste de escrita: "2ª quinta-feira do mês" etc.
    // Vamos montar um formato natural:
    var feminineWeekday = (wd !== 0 && wd !== 6); // seg-sex geralmente com "ª" em abreviação
    var ordDay = ordinalPT(wom, false); // 2º domingo; 2ª quinta (mas por simplicidade texto completo)
    var pretty = "Hoje é " + (wd===0 ? (ordinalPT(wom,false) + " domingo do mês") :
                              wd===6 ? (ordinalPT(wom,false) + " sábado do mês") :
                              (ordinalPT(wom,true) + " " + weekdayPT(wd) + " do mês"));
    el.textContent = line1 + " • " + pretty;
  }

  function updateHighlights(){
    var now = new Date();
    var day = now.getDay();
    var nowMin = now.getHours()*60 + now.getMinutes();
    var dd = pad2(now.getDate());
    var mm = pad2(now.getMonth()+1);
    var todayDM = dd + "/" + mm;

    var clock = byId("clockChip");
    if(clock) clock.textContent = pad2(now.getHours()) + ":" + pad2(now.getMinutes());

    var cards = document.querySelectorAll(".daycard");
    for(var i=0;i<cards.length;i++) cards[i].classList.remove("today");
    for(var b=0;b<7;b++){ var bd=byId("badge-"+b); if(bd){ bd.classList.remove("today"); bd.textContent="Agenda"; } }
    var items = document.querySelectorAll(".item");
    for(var j=0;j<items.length;j++){ items[j].classList.remove("next"); items[j].classList.remove("past"); }

    var todayCard = document.querySelector('.daycard[data-day="' + day + '"][data-city="' + (currentCity||"diamantina") + '"]');
    if(todayCard) todayCard.classList.add("today");
    var badge = byId("badge-"+day);
    if(badge){ badge.classList.add("today"); badge.textContent="Hoje"; }

    var events = [];
    if(todayCard){
      var its = todayCard.querySelectorAll(".item");
      for(var k=0;k<its.length;k++){
        var it=its[k];
        var t=it.getAttribute("data-time")||"";
        var mins=minutesFromHHMM(t);
        if(mins!==null){
          var a = it.querySelector("a.link");
          events.push({
            type:"Culto ou Reunião",
            mins:mins,
            timeText:t,
            title:it.getAttribute("data-title")||trim(text(it.querySelector(".title"))),
            place:it.getAttribute("data-place")||trim(text(it.querySelector(".place"))),
            maps: a ? a.href : "#",
            ref:it
          });
        }
      }
    }

    // festas do dia
    var trs = document.querySelectorAll("#festasTable tbody tr");
    for(var f=0;f<trs.length;f++){
      var tr=trs[f];
      var d=trim(tr.getAttribute("data-date")||"");
      var t2=trim(tr.getAttribute("data-time")||"");
      if(d && d===todayDM){
        var mins2 = minutesFromHHMM(t2);
        if(mins2===null) mins2=0;
        var tds = tr.querySelectorAll("td");
        var place = trim(text(tds[4]));
        var maps = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(place + ", Amambai MS");
        events.push({
          type:"Festa Espiritual",
          mins:mins2,
          timeText:t2||"—",
          title:trim(text(tds[3])),
          place:place,
          maps:maps,
          ref:null
        });
      }
    }

    events.sort(function(a,b){ return a.mins-b.mins; });

    var nextEv=null;
    for(var e=0;e<events.length;e++){ if(events[e].mins>=nowMin){ nextEv=events[e]; break; } }

    for(var c=0;c<events.length;c++){
      if(events[c].ref){
        if(events[c].mins < nowMin) events[c].ref.classList.add("past");
        else if(nextEv && events[c].title===nextEv.title && events[c].place===nextEv.place && events[c].timeText===nextEv.timeText) events[c].ref.classList.add("next");
      }
    }

    var big = byId("bannerBig");
    var small = byId("bannerSmall");
    var count = byId("countChip");
    var mapsChip = byId("mapsChip");

    var cityLabelEl = document.querySelector(".ctab.active");
    var cityLabel = cityLabelEl ? cityLabelEl.innerText : "Amambai";
    if(big) big.textContent = "HOJE — " + cityLabel + " • " + weekdayName[day] + " (" + todayDM + ")";

    if(!events.length){
      if(small) small.textContent = "Nenhum evento cadastrado para hoje.";
      if(count) count.textContent = "Falta: —";
      if(mapsChip) mapsChip.style.display="none";
      return;
    }

    if(nextEv){
      var left = nextEv.mins - nowMin;
      if(small) small.textContent = "Próximo: " + nextEv.timeText + " — " + nextEv.title + " (" + nextEv.place + ")";
      if(count) count.textContent = "Falta: " + formatCountdown(left);
      if(mapsChip){ mapsChip.style.display="inline-flex"; mapsChip.href = nextEv.maps || "#"; mapsChip.textContent="Abrir no Maps"; }
    } else {
      if(small) small.textContent = "Hoje: eventos concluídos.";
      if(count) count.textContent = "Falta: 0 min";
      if(mapsChip) mapsChip.style.display="none";
    }
  }

  function init(){
    initTheme();
    setOnlyToday(getOnlyToday());
    currentCity = hashToCity() || getSavedCity();
    // aplicar cidade salva na interface
    var tabs = document.querySelectorAll('.ctab');
    for(var i=0;i<tabs.length;i++){
      if(tabs[i].getAttribute('data-city') === currentCity){ tabs[i].classList.add('active'); tabs[i].setAttribute('aria-selected','true'); }
      else { tabs[i].classList.remove('active'); tabs[i].setAttribute('aria-selected','false'); }
    }
    updateHighlights();
    applyAllFilters();
    updateWeekInfo();
    window.addEventListener('hashchange', function(){
  var c = hashToCity();
  if(c && c !== currentCity){ window.setCity(c); }
});
setInterval(function(){ updateHighlights(); applyAllFilters(); updateWeekInfo(); }, 60000);
  }
  init();
})();
</script>
</body>
</html>
